(function(n){"use strict";n.IntelliFactory={Runtime:{Ctor:function(n,t){return n.prototype=t.prototype,n},Class:function(n,t,i){var u=n,f,r,e;if(t){u=new t;for(f in n)u[f]=n[f]}if(r=function(n){if(n)for(var t in n)this[t]=n[t]},r.prototype=u,i)for(e in i)r[e]=i[e];return r},Clone:function(n){var t={};for(var i in n)t[i]=n[i];return t},NewObject:function(n){for(var i={},t=0;t<n.length;t++)i[n[t][0]]=n[t][1];return i},PrintObject:function(n){var t=n.constructor.name+" { ",i=!0;for(field in n)i?i=!1:t+=", ",t+=field+" = "+n[field];return t+(i?"}":" }")},DeleteEmptyFields:function(n,t){for(var r,i=0;i<t.length;i++)r=t[i],n[r]===void 0&&delete n[r];return n},GetOptional:function(n){return n===void 0?null:{$:1,$0:n}},SetOptional:function(n,t,i){i?n[t]=i.$0:delete n[t]},SetOrDelete:function(n,t,i){i===void 0?delete n[t]:n[t]=i},Apply:function(n,t,i){return n.apply(t,i)},Bind:function(n){return function(){return n.apply(this,arguments)}},CreateFuncWithArgs:function(n){return function(){return n(Array.prototype.slice.call(arguments))}},CreateFuncWithOnlyThis:function(n){return function(){return n(this)}},CreateFuncWithThis:function(n){return function(){return n(this).apply(null,arguments)}},CreateFuncWithThisArgs:function(n){return function(){return n(this)(Array.prototype.slice.call(arguments))}},CreateFuncWithRest:function(n,t){return function(){return t(Array.prototype.slice.call(arguments,0,n).concat([Array.prototype.slice.call(arguments,n)]))}},CreateFuncWithArgsRest:function(n,t){return function(){return t([Array.prototype.slice.call(arguments,0,n),Array.prototype.slice.call(arguments,n)])}},BindDelegate:function(n,t){var i=n.bind(t);return i.$Func=n,i.$Target=t,i},CreateDelegate:function(n){if(n.length==0)return null;if(n.length==1)return n[0];var t=function(){for(var i,t=0;t<n.length;t++)i=n[t].apply(null,arguments);return i};return t.$Invokes=n,t},CombineDelegates:function(n){for(var t,i=[],r=0;r<n.length;r++)t=n[r],t&&("$Invokes"in t?i=i.concat(t.$Invokes):i.push(t));return IntelliFactory.Runtime.CreateDelegate(i)},DelegateEqual:function(n,t){var f,e,i,r,u;if(n===t)return!0;if(n==null||t==null||(f=n.$Invokes||[n],e=t.$Invokes||[t],f.length!=e.length))return!1;for(i=0;i<f.length;i++)if(r=f[i],u=e[i],!(r===u||"$Func"in r&&"$Func"in u&&r.$Func===u.$Func&&r.$Target==u.$Target))return!1;return!0},ThisFunc:function(n){return function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),n.apply(null,t)}},ThisFuncOut:function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(t.shift(),t)}},ParamsFunc:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(null,i.slice(0,n).concat([i.slice(n)]))}},ParamsFuncOut:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(null,i.slice(0,n).concat(i[n]))}},ThisParamsFunc:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return i.unshift(this),t.apply(null,i.slice(0,n+1).concat([i.slice(n+1)]))}},ThisParamsFuncOut:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(i.shift(),i.slice(0,n).concat(i[n]))}},Curried:function(n,t,i){return i=i||[],function(r){var u=i.concat([r===void 0?null:r]);return t==1?n.apply(null,u):t==2?function(t){return n.apply(null,u.concat([t===void 0?null:t]))}:IntelliFactory.Runtime.Curried(n,t-1,u)}},Curried2:function(n){return function(t){return function(i){return n(t,i)}}},Curried3:function(n){return function(t){return function(i){return function(r){return n(t,i,r)}}}},UnionByType:function(n,t,i){for(var u,f=typeof t,r=0;r<n.length;r++)if(u=n[r],typeof u=="number"){if(Array.isArray(t)&&(u==0||t.length==u))return{$:r,$0:t}}else if(u==f)return{$:r,$0:t};if(!i)throw new Error("Type not expected for creating Choice value.");},ScriptBasePath:"./",ScriptPath:function(n,t){return this.ScriptBasePath+(this.ScriptSkipAssemblyDir?"":n+"/")+t},OnLoad:function(n){"load"in this||(this.load=[]);this.load.push(n)},Start:function(){function n(n){for(var t=0;t<n.length;t++)n[t]()}"load"in this&&(n(this.load),this.load=[])}}};n.IntelliFactory.Runtime.OnLoad(function(){n.WebSharper&&WebSharper.Activator&&WebSharper.Activator.Activate&&WebSharper.Activator.Activate()});Date.now||(Date.now=function(){return(new Date).getTime()});Math.trunc||(Math.trunc=function(n){return n<0?Math.ceil(n):Math.floor(n)});Object.setPrototypeOf||(Object.setPrototypeOf=function(n,t){return n.__proto__=t,n});n.ignore=function(){};n.id=function(n){return n};n.fst=function(n){return n[0]};n.snd=function(n){return n[1]};n.trd=function(n){return n[2]};n.console||(n.console={count:ignore,dir:ignore,error:ignore,group:ignore,groupEnd:ignore,info:ignore,log:ignore,profile:ignore,profileEnd:ignore,time:ignore,timeEnd:ignore,trace:ignore,warn:ignore})})(self);
/* https://github.com/jonathantneal/closest */
(function(w,p){p=w.Element.prototype
if(!p.matches){p.matches=p.msMatchesSelector||function(s){var m=(this.document||this.ownerDocument).querySelectorAll(s);for(var i=0;m[i]&&m[i]!==e;++i);return!!m[i]}}
if(!p.closest){p.closest=function(s){var e=this;while(e&&e.nodeType==1){if(e.matches(s))return e;e=e.parentNode}return null}}})(self);
(function(){for(var i=0,t=["webkit","moz"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var t=(new Date).getTime(),r=Math.max(0,16-(t-i)),u=window.setTimeout(function(){n(t+r)},r);return i=t+r,u});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})})();
(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca;b=a.PrettyTodo=a.PrettyTodo||{};c=b.Client=b.Client||{};d=a.WebSharper=a.WebSharper||{};e=d.UI=d.UI||{};f=e.Client=e.Client||{};g=f.Templates=f.Templates||{};h=d.Obj=d.Obj||{};i=e.Doc=e.Doc||{};j=d.JavaScript=d.JavaScript||{};k=j.Pervasives=j.Pervasives||{};l=a.StartupCode$todo$Client=a.StartupCode$todo$Client||{};m=d.Operators=d.Operators||{};n=a.EventTarget;o=a.Node;p=j.JS=j.JS||{};q=d.Collections=d.Collections||{};r=q.Dictionary=q.Dictionary||{};s=d.Unchecked=d.Unchecked||{};t=d.Sitelets=d.Sitelets||{};u=t.RouterModule=t.RouterModule||{};v=d.List=d.List||{};w=v.T=v.T||{};x=c.Filter=c.Filter||{};y=e.ListModel=e.ListModel||{};z=c.TodoItem=c.TodoItem||{};A=e.Router=e.Router||{};B=e.Var$1=e.Var$1||{};C=e.AttrModule=e.AttrModule||{};D=e.View=e.View||{};E=e.Var=e.Var||{};F=e.Templating=e.Templating||{};G=F.Runtime=F.Runtime||{};H=G.Server=G.Server||{};I=H.TemplateInstance=H.TemplateInstance||{};J=d.Arrays=d.Arrays||{};K=H.ProviderBuilder=H.ProviderBuilder||{};L=H.Handler=H.Handler||{};M=a.todo_Templates=a.todo_Templates||{};N=a.StartupCode$WebSharper_UI$Templates=a.StartupCode$WebSharper_UI$Templates||{};O=q.HashSet=q.HashSet||{};P=d.Seq=d.Seq||{};Q=a.WindowOrWorkerGlobalScope;R=e.Docs=e.Docs||{};S=t.Router=t.Router||{};T=t.Route=t.Route||{};U=e.Storage=e.Storage||{};V=d.Numeric=d.Numeric||{};W=e.ConcreteVar=e.ConcreteVar||{};X=e.Snap=e.Snap||{};Y=e.Attrs=e.Attrs||{};Z=e.DomUtility=e.DomUtility||{};_0=a.System=a.System||{};_1=_0.Guid=_0.Guid||{};_2=q.List=q.List||{};_3=e.AttrProxy=e.AttrProxy||{};_4=d.Option=d.Option||{};_5=a.Event;_6=a.UIEvent;_7=d.Strings=d.Strings||{};_8=q.DictionaryUtil=q.DictionaryUtil||{};_9=a.Object;_=g.Prepare=g.Prepare||{};$=d.Slice=d.Slice||{};ba=d.Enumerator=d.Enumerator||{};bb=q.KeyCollection=q.KeyCollection||{};bc=e.DocElemNode=e.DocElemNode||{};bd=a.CharacterData;be=e.An=e.An||{};bf=f.Settings=f.Settings||{};bg=e.Abbrev=e.Abbrev||{};bh=bg.Mailbox=bg.Mailbox||{};bi=q.FSharpMap=q.FSharpMap||{};bj=U.ArrayStorage=U.ArrayStorage||{};bk=bg.Fresh=bg.Fresh||{};bl=e.DynamicAttrNode=e.DynamicAttrNode||{};bm=e.HtmlModule=e.HtmlModule||{};bn=bm.attr=bm.attr||{};bo=e.Array=e.Array||{};bp=H.TemplateInitializer=H.TemplateInitializer||{};bq=f.Attrs=f.Attrs||{};br=bq.Dyn=bq.Dyn||{};bs=f.Docs=f.Docs||{};bt=bs.RunState=bs.RunState||{};bu=bs.NodeSet=bs.NodeSet||{};bv=d.Concurrency=d.Concurrency||{};bw=e.Anims=e.Anims||{};bx=a.StartupCode$WebSharper_UI$Doc_Proxy=a.StartupCode$WebSharper_UI$Doc_Proxy||{};by=q.BalancedTree=q.BalancedTree||{};bz=by.Tree=by.Tree||{};bA=q.Pair=q.Pair||{};bB=q.Map=q.Map||{};bC=d.Lazy=d.Lazy||{};bD=d.Utils=d.Utils||{};bE=e.CheckedInput=e.CheckedInput||{};bF=ba.T=ba.T||{};bG=e.BindVar=e.BindVar||{};bH=e.Elt=e.Elt||{};bI=a.StartupCode$WebSharper_UI$DomUtility=a.StartupCode$WebSharper_UI$DomUtility||{};bJ=a.StartupCode$WebSharper_UI$Animation=a.StartupCode$WebSharper_UI$Animation||{};bK=e.AppendList=e.AppendList||{};bL=d.LazyExtensionsProxy=d.LazyExtensionsProxy||{};bM=bL.LazyRecord=bL.LazyRecord||{};bN=t.PathUtil=t.PathUtil||{};bO=a.StartupCode$WebSharper_UI$Abbrev=a.StartupCode$WebSharper_UI$Abbrev||{};bP=a.StartupCode$WebSharper_UI$Attr_Client=a.StartupCode$WebSharper_UI$Attr_Client||{};bQ=e.Updates=e.Updates||{};bR=q.HashSetUtil=q.HashSetUtil||{};bS=bv.Scheduler=bv.Scheduler||{};bT=e.Easing=e.Easing||{};bU=bv.AsyncBody=bv.AsyncBody||{};bV=a.StartupCode$WebSharper_Main$Concurrency=a.StartupCode$WebSharper_Main$Concurrency||{};bW=bv.CT=bv.CT||{};bX=bg.HashSet=bg.HashSet||{};bY=q.MapUtil=q.MapUtil||{};bZ=d.Queue=d.Queue||{};b0=e.String=e.String||{};b1=d.CancellationTokenSource=d.CancellationTokenSource||{};b2=bs.DomNodes=bs.DomNodes||{};b3=d.Char=d.Char||{};b4=q.ValueCollection=q.ValueCollection||{};b5=a.Error;b6=d.OperationCanceledException=d.OperationCanceledException||{};b7=a.StartupCode$WebSharper_UI$AppendList=a.StartupCode$WebSharper_UI$AppendList||{};b8=a.IntelliFactory;b9=b8&&b8.Runtime;b_=a.console;b$=a.Math;ca=a.Date;c.Main=function(){var cb;cb=c.TodoApp();g.LoadLocalTemplates("");i.RunById("main",cb);};c.TodoApp=function(){l.$cctor();return l.TodoApp;};c.Pages=function(){l.$cctor();return l.Pages;};c.notDoneItemsCount=function(cb){return D.Map(function(cc){return P.sumBy(function(cd){return cd.IsDone?0:1;},cc);},cb.v);};c.RenderList=function(cb,cc){return i.Flatten(cb.MapLens(function(cd,ce){return c.RenderTodo(cb,cc,cd,ce);}));};c.ShowIfNotEmpty=function(cb,cc){return i.EmbedView(D.Map(function(cd){return P.isEmpty(cd)?i.get_Empty():cc;},cb.v));};c.op_EqualsEqualsGreater=function(cb,cc){return _3.Create(cb,cc);};c.ToggleAllDone=function(cb){var cc;cc=cb.TryFind(function(cd){return!cd.IsDone;})!=null;cb.UpdateAll(function(cd){return{$:1,$0:z.New(cd.Id,cd.Text,cc,cd.IsEditing)};});};c.RemoveCompleted=function(cb){cb.RemoveBy(function(cc){return cc.IsDone;});};c.onEnter=function(cb,cc){if(cb.keyCode===13||cb.which===13)cc();};c.mkTodo=function(cb){return z.New(c.fresh(),cb,false,false);};c.hasAnyDoneItems=function(cb){function cc(cd){return cd.IsDone;}return D.Map(function(cd){return P.exists(cc,cd);},cb.v);};c.RenderTodo=function(cb,cc,cd,ce){var cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct;function cu(cy){if(cy==="")cb.RemoveByKey(cd);else ce.Update(function(cz){return z.New(cz.Id,cy,cz.IsDone,false);});}function cv(cy,cz,cA){c.onEnter(cy,function(){cu(cA);});return c.onEscape(cy,function(){cu(cz);});}function cw(){ce.Update(function(cy){B.Set(cf,cy.Text);return z.New(cy.Id,cy.Text,cy.IsDone,true);});}function cx(cy,cz){return cz.$==1?!cy.IsDone:cz.$==2?cy.IsDone:true;}cf=B.Create$1("");cg=i.Input([_3.Create("class","edit"),C.HandlerView("keydown",ce.get_View(),b9.Curried3(function(cy,cz,cA){return cv(cz,cA.Text,cf.Get());})),C.HandlerView("blur",ce.get_View(),b9.Curried3(function(cy,cz,cA){return cu(cA.Text);})),C.OnAfterRender(function(cy){cy.focus();})],cf);ch=(ci=(cj=(ck=B.Lens(ce,function(cy){return cy.IsDone;},function(cy,cz){return z.New(cy.Id,cy.Text,cz,cy.IsEditing);}),(cl=(cm=(cn=(co=D.Map(function(cy){return cy.Text;},ce.get_View()),(cp=(cq=D.Map(function(cy){return _7.concat(" ",v.ofSeq(P.delay(function(){return P.append(cy.IsEditing?["editing"]:[],P.delay(function(){return cy.IsDone?["completed"]:[];}));})));},ce.get_View()),(cr=new K.New$1(),(cr.h.push({$:2,$0:"itemstate",$1:cq}),cr))),(cp.h.push({$:2,$0:"title",$1:co}),cp))),(cn.h.push(L.EventQ2(cn.k,"destroy",function(){return cn.i;},function(){cb.RemoveByKey(cd);})),cn)),(cm.h.push(L.EventQ2(cm.k,"edit",function(){return cm.i;},function(){cw();})),cm)),(cl.h.push({$:9,$0:"checked",$1:ck}),cl))),(cj.h.push({$:0,$0:"titleediting",$1:cg}),cj)),(cs=L.CompleteHoles(ci.k,ci.h,[["checked",2]]),(ct=new I.New(cs[1],M.listitem(cs[0])),ci.i=ct,ct))).get_Doc();return i.EmbedView(D.Map2(function(cy,cz){return cx(cy,cz)?ch:i.get_Empty();},ce.get_View(),cc));};c.fresh=function(){var cb;cb=c.runningId();c.set_runningId(c.runningId()+1);return cb;};c.onEscape=function(cb,cc){if(cb.keyCode===27||cb.which===27)cc();};c.set_runningId=function(cb){l.$cctor();l.runningId=cb;};c.runningId=function(){l.$cctor();return l.runningId;};g.LoadLocalTemplates=function(cb){!g.LocalTemplatesLoaded()?(g.set_LocalTemplatesLoaded(true),g.LoadNestedTemplates(self.document.body,"")):void 0;g.LoadedTemplates().set_Item(cb,g.LoadedTemplateFile(""));};g.LocalTemplatesLoaded=function(){N.$cctor();return N.LocalTemplatesLoaded;};g.set_LocalTemplatesLoaded=function(cb){N.$cctor();N.LocalTemplatesLoaded=cb;};g.LoadNestedTemplates=function(cb,cc){var ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq;function cd(cr){var cs,ct;if(!ce.ContainsKey(cr)){cs=(ct=null,[cf.TryGetValue(cr,{get:function(){return ct;},set:function(cu){ct=cu;}}),ct]);if(cs[0]){cq.Add(cr);cf.Remove(cr);g.PrepareTemplateStrict(cc,{$:1,$0:cr},cs[1],{$:1,$0:cd});}else b_.warn(cq.Contains(cr)?"Encountered loop when instantiating "+cr:"Local template does not exist: "+cr);}}ce=g.LoadedTemplateFile(cc);cf=new r.New$5();cg=cb.querySelectorAll("[ws-template]");for(ch=0,ci=cg.length-1;ch<=ci;ch++){cj=cg[ch];ck=cj.getAttribute("ws-template").toLowerCase();cj.removeAttribute("ws-template");cf.set_Item(ck,g.FakeRootSingle(cj));}cl=cb.querySelectorAll("[ws-children-template]");for(cm=0,cn=cl.length-1;cm<=cn;cm++){co=cl[cm];cp=co.getAttribute("ws-children-template").toLowerCase();co.removeAttribute("ws-children-template");cf.set_Item(cp,g.FakeRoot(co));}cq=new O.New$3();while(cf.count>0)cd(P.head(cf.get_Keys()));};g.LoadedTemplates=function(){N.$cctor();return N.LoadedTemplates;};g.LoadedTemplateFile=function(cb){var cc,cd,ce;cc=(cd=null,[g.LoadedTemplates().TryGetValue(cb,{get:function(){return cd;},set:function(cf){cd=cf;}}),cd]);return cc[0]?cc[1]:(ce=new r.New$5(),(g.LoadedTemplates().set_Item(cb,ce),ce));};g.FakeRootSingle=function(cb){var cc,cd,ce,cf;cb.removeAttribute("ws-template");cc=cb.getAttribute("ws-replace");if(cc===null);else{cb.removeAttribute("ws-replace");cd=cb.parentNode;s.Equals(cd,null)?void 0:(ce=self.document.createElement(cb.tagName),ce.setAttribute("ws-replace",cc),cd.replaceChild(ce,cb));}cf=self.document.createElement("div");cf.appendChild(cb);return cf;};g.FakeRoot=function(cb){var cc;cc=self.document.createElement("div");while(cb.hasChildNodes())cc.appendChild(cb.firstChild);return cc;};g.PrepareTemplateStrict=function(cb,cc,cd,ce){var cf;function cg(cm,cn){var co,cp,cq,cr,cs,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO;function ct(cP){}while(true)switch(cm){case 0:if(cn!==null){co=cn.nextSibling;if(s.Equals(cn.nodeType,o.TEXT_NODE))_.convertTextNode(cn);else if(s.Equals(cn.nodeType,o.ELEMENT_NODE))ci(cn);cn=co;}else return null;break;case 1:cu=$.string(cn.nodeName,{$:1,$0:3},null).toLowerCase();cv=(cp=cu.indexOf("."),cp===-1?[cb,cu]:[$.string(cu,null,{$:1,$0:cp-1}),$.string(cu,{$:1,$0:cp+1},null)]);cw=cv[1];cx=cv[0];if(cx!==""&&!g.LoadedTemplates().ContainsKey(cx))return _.failNotLoaded(cw);else{if(cx===""&&ce!=null)ce.$0(cw);cy=g.LoadedTemplates().get_Item(cx);if(!cy.ContainsKey(cw))return _.failNotLoaded(cw);else{cz=cy.get_Item(cw);cA=cz.cloneNode(true);cB=new O.New$3();cC=new r.New$5();cD=cn.attributes;for(cE=0,cF=cD.length-1;cE<=cF;cE++){cG=cD.item(cE).name.toLowerCase();cC.set_Item(cG,(cH=cD.item(cE).nodeValue,cH===""?cG:cH.toLowerCase()));if(!cB.Add(cG))b_.warn("Hole mapped twice",cG);}for(cI=0,cJ=cn.childNodes.length-1;cI<=cJ;cI++){cK=cn.childNodes[cI];if(s.Equals(cK.nodeType,o.ELEMENT_NODE))!cB.Add(cK.nodeName.toLowerCase())?b_.warn("Hole filled twice",cw):void 0;}cL=cn.childNodes.length===1&&s.Equals(cn.firstChild.nodeType,o.TEXT_NODE);if(cL){cr=_.fillTextHole(cA,cn.firstChild.textContent,cw);((function(cP){return function(cQ){if(cQ!=null)cP(cQ.$0);};}((cs=function(cP){return function(cQ){return cP.Add(cQ);};}(cB),function(cP){return ct(cs(cP));})))(cr));}_.removeHolesExcept(cA,cB);if(!cL){for(cM=0,cN=cn.childNodes.length-1;cM<=cN;cM++){cO=cn.childNodes[cM];if(s.Equals(cO.nodeType,o.ELEMENT_NODE))cO.hasAttributes()?_.fillInstanceAttrs(cA,cO):ch(cA,cO);}}_.mapHoles(cA,cC);_.fill(cA,cn.parentNode,cn);cn.parentNode.removeChild(cn);return;}}break;}}function ch(cm,cn){var co,cq,cr;function cp(cs,ct){var cu;if(cq==="title"&&cn.hasChildNodes()){cu=Z.ParseHTMLIntoFakeRoot(cn.textContent);cn.removeChild(cn.firstChild);while(cu.hasChildNodes())cn.appendChild(cu.firstChild);}else null;ci(cn);return _.fill(cn,cs,ct);}cq=cn.nodeName.toLowerCase();g.foreachNotPreserved(cm,"[ws-attr-holes]",function(cs){var ct,cu,cv,cw,cx;ct=_7.SplitChars(cs.getAttribute("ws-attr-holes"),[" "],1);for(cu=0,cv=ct.length-1;cu<=cv;cu++){cw=J.get(ct,cu);cs.setAttribute(cw,(cx=new a.RegExp("\\${"+cq+"}","ig"),cs.getAttribute(cw).replace(cx,cn.textContent)));}});cr=cm.querySelector("[ws-hole="+cq+"]");if(s.Equals(cr,null)){co=cm.querySelector("[ws-replace="+cq+"]");return s.Equals(co,null)?null:(cp(co.parentNode,co),void co.parentNode.removeChild(co));}else{while(cr.hasChildNodes())cr.removeChild(cr.lastChild);cr.removeAttribute("ws-hole");return cp(cr,null);}}function ci(cm){if(!cm.hasAttribute("ws-preserve"))if(_7.StartsWith(cm.nodeName.toLowerCase(),"ws-"))ck(cm);else{_.convertAttrs(cm);cj(cm.firstChild);}}function cj(cm){return cg(0,cm);}function ck(cm){return cg(1,cm);}function cl(cm){var cn,co,cp,cq;while(true){cn=cm.querySelector("[ws-template]");if(s.Equals(cn,null)){co=cm.querySelector("[ws-children-template]");if(s.Equals(co,null))return null;else{cp=co.getAttribute("ws-children-template");co.removeAttribute("ws-children-template");g.PrepareTemplateStrict(cb,{$:1,$0:cp},co,null);cm=cm;}}else{cq=cn.getAttribute("ws-template");(g.PrepareSingleTemplate(cb,{$:1,$0:cq},cn))(null);cm=cm;}}}cf=(cc==null?"":cc.$0).toLowerCase();g.LoadedTemplateFile(cb).set_Item(cf,cd);if(cd.hasChildNodes()){cl(cd);cj(cd.firstChild);}};g.foreachNotPreserved=function(cb,cc,cd){Z.IterSelector(cb,cc,function(ce){if(ce.closest("[ws-preserve]")==null)cd(ce);});};g.PrepareSingleTemplate=function(cb,cc,cd){var ce;ce=g.FakeRootSingle(cd);return function(cf){g.PrepareTemplateStrict(cb,cc,ce,cf);};};g.GetOrLoadTemplate=function(cb,cc,cd,ce){g.LoadLocalTemplates("");g.PrepareTemplate(cb,cc,cd);return g.NamedTemplate(cb,cc,ce);};g.PrepareTemplate=function(cb,cc,cd){if(!g.LoadedTemplateFile(cb).ContainsKey(cc==null?"":cc.$0))g.PrepareTemplateStrict(cb,cc,cd(),null);};g.TextHoleRE=function(){N.$cctor();return N.TextHoleRE;};g.NamedTemplate=function(cb,cc,cd){var ce,cf;ce=(cf=null,[g.LoadedTemplateFile(cb).TryGetValue(cc==null?"":cc.$0,{get:function(){return cf;},set:function(cg){cf=cg;}}),cf]);return ce[0]?g.ChildrenTemplate(ce[1].cloneNode(true),cd):(b_.warn("Local template doesn't exist",cc),i.get_Empty());};g.ChildrenTemplate=function(cb,cc){var cd,ce,cf,cg,ch;cd=g.InlineTemplate(cb,P.append(cc,g.GlobalHoles().get_Values()));ce=cd[1];cf=cd[0];cg=cf.Els;return!s.Equals(cg,null)&&cg.length===1&&(J.get(cg,0)instanceof o&&(s.Equals(J.get(cg,0).nodeType,o.ELEMENT_NODE)&&(ch=J.get(cg,0),true)))?bH.TreeNode(cf,ce):i.Mk({$:6,$0:cf},ce);};g.InlineTemplate=function(cb,cc){var cd,ce,cf,cg,cj,ck,cl,cm,cn,co,cp;function ch(cq,cr){var cs,ct,cu;cs=Y.Insert(cq,cr);ck.push(Y.Updates(cs));cl.push([cq,cs]);ct=b9.GetOptional(cs.OnAfterRender);return ct==null?null:(cu=ct.$0,void cm.push(function(){cu(cq);}));}function ci(cq){var cr,cs;cr=(cs=null,[cn.TryGetValue(cq,{get:function(){return cs;},set:function(ct){cs=ct;}}),cs]);return cr[0]?cr[1].$==0?{$:1,$0:cr[1].$1}:cr[1].$==1?{$:1,$0:i.TextNode(cr[1].$1)}:cr[1].$==2?{$:1,$0:i.TextView(cr[1].$1)}:cr[1].$==8?{$:1,$0:i.TextView(cr[1].$1.get_View())}:cr[1].$==9?{$:1,$0:i.TextView(D.Map(a.String,cr[1].$1.get_View()))}:cr[1].$==10?{$:1,$0:i.TextView(D.Map(function(ct){return ct.get_Input();},cr[1].$1.get_View()))}:cr[1].$==11?{$:1,$0:i.TextView(D.Map(a.String,cr[1].$1.get_View()))}:cr[1].$==12?{$:1,$0:i.TextView(D.Map(function(ct){return ct.get_Input();},cr[1].$1.get_View()))}:cr[1].$==13?{$:1,$0:i.TextView(D.Map(a.String,cr[1].$1.get_View()))}:(b_.warn("Content hole filled with attribute data",cq),null):null;}cj=[];ck=[];cl=[];cm=[];cn=new r.New$5();co=ba.Get(cc);try{while(co.MoveNext()){cp=co.Current();cn.set_Item(cp.$0,cp);}}finally{if(typeof co=="object"&&"Dispose"in co)co.Dispose();}cd=Z.ChildrenArray(cb);g.foreachNotPreserved(cb,"[ws-hole]",function(cq){var cr,cs,ct;ct=cq.getAttribute("ws-hole");cq.removeAttribute("ws-hole");while(cq.hasChildNodes())cq.removeChild(cq.lastChild);cr=ci(ct);if(cr!=null&&cr.$==1){cs=cr.$0;R.LinkElement(cq,cs.docNode);cj.push(bc.New(Y.Empty(cq),cs.docNode,null,cq,bk.Int(),null));ck.push(cs.updates);}});g.foreachNotPreserved(cb,"[ws-replace]",function(cq){var cr,cs,ct,cu,cv,cw;cr=ci(cq.getAttribute("ws-replace"));if(cr!=null&&cr.$==1){cs=cr.$0;ct=cq.parentNode;cu=self.document.createTextNode("");ct.replaceChild(cu,cq);cv=R.InsertBeforeDelim(cu,cs.docNode);cw=J.tryFindIndex(function(cx){return cq===cx;},cd);cw==null?void 0:J.set(cd,cw.$0,cs.docNode);cj.push(bc.New(Y.Empty(ct),cs.docNode,{$:1,$0:[cv,cu]},ct,bk.Int(),null));ck.push(cs.updates);}});g.foreachNotPreserved(cb,"[ws-attr]",function(cq){var cr,cs,ct;cr=cq.getAttribute("ws-attr");cq.removeAttribute("ws-attr");cs=(ct=null,[cn.TryGetValue(cr,{get:function(){return ct;},set:function(cu){ct=cu;}}),ct]);if(cs[0])cs[1].$==3?ch(cq,cs[1].$1):b_.warn("Attribute hole filled with non-attribute data",cr);});g.foreachNotPreserved(cb,"[ws-on]",function(cq){ch(cq,_3.Concat(J.choose(function(cr){var cs,ct,cu;cs=_7.SplitChars(cr,[":"],1);ct=(cu=null,[cn.TryGetValue(J.get(cs,1),{get:function(){return cu;},set:function(cv){cu=cv;}}),cu]);return ct[0]?ct[1].$==4?{$:1,$0:C.Handler(J.get(cs,0),ct[1].$1)}:ct[1].$==5?{$:1,$0:_3.Handler(J.get(cs,0),ct[1].$1)}:(b_.warn("Event hole on"+J.get(cs,0)+" filled with non-event data",J.get(cs,1)),null):null;},_7.SplitChars(cq.getAttribute("ws-on"),[" "],1))));cq.removeAttribute("ws-on");});g.foreachNotPreserved(cb,"[ws-onafterrender]",function(cq){var cr,cs,ct;cr=cq.getAttribute("ws-onafterrender");cs=(ct=null,[cn.TryGetValue(cr,{get:function(){return ct;},set:function(cu){ct=cu;}}),ct]);if(cs[0])cs[1].$==6?(cq.removeAttribute("ws-onafterrender"),ch(cq,C.OnAfterRender(cs[1].$1))):cs[1].$==7?(cq.removeAttribute("ws-onafterrender"),ch(cq,C.OnAfterRender(cs[1].$1))):b_.warn("onafterrender hole filled with non-onafterrender data",cr);});g.foreachNotPreserved(cb,"[ws-var]",function(cq){var cr,cs,ct;cr=cq.getAttribute("ws-var");cq.removeAttribute("ws-var");cs=(ct=null,[cn.TryGetValue(cr,{get:function(){return ct;},set:function(cu){ct=cu;}}),ct]);if(cs[0])cs[1].$==8?ch(cq,C.Value(cs[1].$1)):cs[1].$==9?ch(cq,C.Checked(cs[1].$1)):cs[1].$==10?ch(cq,C.IntValue(cs[1].$1)):cs[1].$==11?ch(cq,C.IntValueUnchecked(cs[1].$1)):cs[1].$==12?ch(cq,C.FloatValue(cs[1].$1)):cs[1].$==13?ch(cq,C.FloatValueUnchecked(cs[1].$1)):b_.warn("Var hole filled with non-Var data",cr);});g.foreachNotPreserved(cb,"[ws-attr-holes]",function(cq){var cr,cs,ct,cu;cr=new a.RegExp(g.TextHoleRE(),"g");cs=_7.SplitChars(cq.getAttribute("ws-attr-holes"),[" "],1);cq.removeAttribute("ws-attr-holes");for(ct=0,cu=cs.length-1;ct<=cu;ct++)(function(){var cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH;cE=J.get(cs,ct);cF=cq.getAttribute(cE);cv=null;cw=0;cG=[];while(cv=cr.exec(cF),cv!==null){cH=$.string(cF,{$:1,$0:cw},{$:1,$0:cr.lastIndex-J.get(cv,0).length-1});cw=cr.lastIndex;cG.push([cH,J.get(cv,1)]);}cy=$.string(cF,{$:1,$0:cw},null);cr.lastIndex=0;cz=J.foldBack(function(cI,cJ){return(function(cK){var cL,cM;cL=cK[0];cM=cK[1];return function(cN){var cO,cP,cQ,cR,cS;cO=cN[0];cP=cN[1];cQ=(cR=(cS=null,[cn.TryGetValue(cM,{get:function(){return cS;},set:function(cT){cS=cT;}}),cS]),cR[0]?cR[1].$==1?{$:0,$0:cR[1].$1}:cR[1].$==2?{$:1,$0:cR[1].$1}:cR[1].$==8?{$:1,$0:cR[1].$1.get_View()}:cR[1].$==9?{$:1,$0:D.Map(a.String,cR[1].$1.get_View())}:cR[1].$==10?{$:1,$0:D.Map(function(cT){return cT.get_Input();},cR[1].$1.get_View())}:cR[1].$==11?{$:1,$0:D.Map(a.String,cR[1].$1.get_View())}:cR[1].$==12?{$:1,$0:D.Map(function(cT){return cT.get_Input();},cR[1].$1.get_View())}:cR[1].$==13?{$:1,$0:D.Map(a.String,cR[1].$1.get_View())}:(b_.warn("Attribute value hole filled with non-text data",cM),{$:0,$0:""}):{$:0,$0:""});return cQ.$==1?[cL,new w({$:1,$0:cO===""?cQ.$0:D.Map(function(cT){return cT+cO;},cQ.$0),$1:cP})]:[cL+cQ.$0+cO,cP];};}(cI))(cJ);},cG,[cy,w.Empty]);return ch(cq,cz[1].$==1?cz[1].$1.$==1?cz[1].$1.$1.$==1?cz[1].$1.$1.$1.$==0?(cA=cz[0],C.Dynamic(cE,D.Map3(function(cI,cJ,cK){return cA+cI+cJ+cK;},cz[1].$0,cz[1].$1.$0,cz[1].$1.$1.$0))):(cB=cz[0],C.Dynamic(cE,D.Map(function(cI){return cB+_7.concat("",cI);},D.Sequence(cz[1])))):(cC=cz[0],C.Dynamic(cE,D.Map2(function(cI,cJ){return cC+cI+cJ;},cz[1].$0,cz[1].$1.$0))):cz[0]===""?C.Dynamic(cE,cz[1].$0):(cD=cz[0],C.Dynamic(cE,D.Map(function(cI){return cD+cI;},cz[1].$0))):_3.Create(cE,cz[0]));}());});return[b9.DeleteEmptyFields({Els:cd,Dirty:true,Holes:cj,Attrs:cl,Render:(ce=cm.length==0?null:{$:1,$0:function(cq){J.iter(function(cr){cr(cq);},cm);}},ce?ce.$0:void 0),El:(cf=!s.Equals(cd,null)&&cd.length===1&&(J.get(cd,0)instanceof o&&(J.get(cd,0)instanceof a.Element&&(cg=J.get(cd,0),true)))?{$:1,$0:cg}:null,cf?cf.$0:void 0)},["Render","El"]),bo.TreeReduce(D.Const(),D.Map2Unit,ck)];};g.GlobalHoles=function(){N.$cctor();return N.GlobalHoles;};h=d.Obj=b9.Class({Equals:function(cb){return this===cb;},GetHashCode:function(){return -1;}},null,h);h.New=b9.Ctor(function(){},h);i=e.Doc=b9.Class({},h,i);i.RunById=function(cb,cc){var cd;cd=self.document.getElementById(cb);if(s.Equals(cd,null))m.FailWith("invalid id: "+cb);else i.Run(cd,cc);};i.Run=function(cb,cc){R.LinkElement(cb,cc.docNode);i.RunInPlace(false,cb,cc);};i.get_Empty=function(){return i.Mk(null,D.Const());};i.RunInPlace=function(cb,cc,cd){var ce;ce=R.CreateRunState(cc,cd.docNode);D.Sink(be.get_UseAnimations()||bf.BatchUpdatesEnabled()?bh.StartProcessor(R.PerformAnimatedUpdate(cb,ce,cd.docNode)):function(){R.PerformSyncUpdate(cb,ce,cd.docNode);},cd.updates);};i.CheckBox=function(cb,cc){return i.InputInternal("input",function(){return P.append(cb,[_3.Create("type","checkbox"),C.Checked(cc)]);});};i.EmbedView=function(cb){var cc;cc=R.CreateEmbedNode();return i.Mk({$:2,$0:cc},D.Map(a.ignore,D.Bind(function(cd){R.UpdateEmbedNode(cc,cd.docNode);return cd.updates;},cb)));};i.Concat=function(cb){var cc;cc=bo.ofSeqNonCopying(cb);return bo.TreeReduce(i.get_Empty(),i.Append,cc);};i.Link=function(cb,cc,cd){var ce,cf;ce=(cf=_3.Concat(cc),_3.Append(_3.Create("href","#"),cf));return bH.New(i.Clickable("a",cd),ce,i.TextNode(cb));};i.Button=function(cb,cc,cd){var ce;ce=_3.Concat(cc);return bH.New(i.Clickable("button",cd),ce,i.TextNode(cb));};i.Mk=function(cb,cc){return new i.New(cb,cc);};i.Flatten=function(cb){return i.EmbedView(D.Map(i.Concat,cb));};i.InputInternal=function(cb,cc){var cd;cd=self.document.createElement(cb);return bH.New(cd,_3.Concat(cc(cd)),i.get_Empty());};i.Append=function(cb,cc){return i.Mk({$:0,$0:cb.docNode,$1:cc.docNode},D.Map2Unit(cb.updates,cc.updates));};i.Element=function(cb,cc,cd){var ce,cf;ce=_3.Concat(cc);cf=i.Concat(cd);return bH.New(self.document.createElement(cb),ce,cf);};i.TextNode=function(cb){return i.Mk({$:5,$0:self.document.createTextNode(cb)},D.Const());};i.Clickable=function(cb,cc){var cd;cd=self.document.createElement(cb);cd.addEventListener("click",function(ce){ce.preventDefault();return cc();},false);return cd;};i.Input=function(cb,cc){return i.InputInternal("input",function(){return P.append(cb,[C.Value(cc)]);});};i.TextView=function(cb){var cc;cc=R.CreateTextNode();return i.Mk({$:4,$0:cc},D.Map(function(cd){R.UpdateTextNode(cc,cd);},cb));};i.New=b9.Ctor(function(cb,cc){h.New.call(this);this.docNode=cb;this.updates=cc;},i);k.NewFromSeq=function(cb){var cc,cd,ce;cc={};cd=ba.Get(cb);try{while(cd.MoveNext()){ce=cd.Current();cc[ce[0]]=ce[1];}}finally{if(typeof cd=="object"&&"Dispose"in cd)cd.Dispose();}return cc;};l.$cctor=function(){var cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC;l.$cctor=a.ignore;function cD(cF){c.onEnter(cF,function(){var cG;cG=_7.Trim(cd.Get());if(cG!==""){cb.Append(c.mkTodo(cG));B.Set(cd,"");}});}function cE(cF){return C.DynamicClassPred("selected",D.Map(function(cG){return s.Equals(cF,cG);},cc.get_View()));}l.Pages=u.Create(function(cF){return cF.$==1?v.ofArray(["active"]):cF.$==2?v.ofArray(["completed"]):w.Empty;},function(cF){var cG;switch(cF.$==1?cF.$0==="active"?cF.$1.$==0?0:2:cF.$0==="completed"?cF.$1.$==0?1:2:2:2){case 0:return{$:1,$0:x.Active};case 1:return{$:1,$0:x.Completed};case 2:return{$:1,$0:x.All};}});l.runningId=0;l.TodoApp=(cb=y.Create(function(cF){return cF.Id;},w.Empty),(cc=A.Install(x.All,c.Pages()),(cd=B.Create$1(""),(ce=B.Create$1(false),(cf=c.notDoneItemsCount(cb),(cg=D.Map(function(cF){return cF===0;},cf),(ch=(ci=c.ShowIfNotEmpty(cb,(cj=(ck=i.EmbedView(D.Map(function(cF){return cF?i.Button("Clear Completed",[c.op_EqualsEqualsGreater("class","clear-completed")],function(){c.RemoveCompleted(cb);}):i.get_Empty();},c.hasAnyDoneItems(cb))),(cl=(cm=v.ofArray([i.Element("li",[],[i.Link("All",[cE(x.All)],function(){B.Set(cc,x.All);})]),i.Element("li",[],[i.Link("Active",[cE(x.Active)],function(){B.Set(cc,x.Active);})]),i.Element("li",[],[i.Link("Completed",[cE(x.Completed)],function(){B.Set(cc,x.Completed);})])]),(cn=(co=D.Map(function(cF){return cF===1?"item":"items";},cf),(cp=(cq=D.Map(a.String,cf),(cr=new K.New$1(),(cr.h.push({$:2,$0:"remaining",$1:cq}),cr))),(cp.h.push({$:2,$0:"remaininglabel",$1:co}),cp))),(cn.h.push({$:0,$0:"filters",$1:i.Concat(cm)}),cn))),(cl.h.push({$:0,$0:"clearcompleted",$1:ck}),cl))),(cs=L.CompleteHoles(cj.k,cj.h,[]),(ct=new I.New(cs[1],M.footertemplate(cs[0])),cj.i=ct,ct))).get_Doc()),(cu=(cv=c.ShowIfNotEmpty(cb,i.EmbedView(D.Map(function(){return i.CheckBox([c.op_EqualsEqualsGreater("class","toggle-all"),c.op_EqualsEqualsGreater("type","checkbox"),C.Handler("click",function(){return function(){return c.ToggleAllDone(cb);};})],ce);},cg))),(cw=(cx=(cy=c.RenderList(cb,cc.get_View()),(cz=(cA=new K.New$1(),(cA.h.push({$:8,$0:"newtask",$1:cd}),cA)),(cz.h.push({$:0,$0:"todolist",$1:cy}),cz))),(cx.h.push(L.EventQ2(cx.k,"add",function(){return cx.i;},function(cF){cD(cF.Event);})),cx)),(cw.h.push({$:0,$0:"toggleall",$1:cv}),cw))),(cu.h.push({$:0,$0:"footer",$1:ci}),cu))),(cB=L.CompleteHoles(ch.k,ch.h,[["newtask",0]]),(cC=new I.New(cB[1],M.t(cB[0])),ch.i=cC,cC))).get_Doc()))))));};m.FailWith=function(cb){throw new b5(cb);};m.KeyValue=function(cb){return[cb.K,cb.V];};p.GetFieldValues=function(cb){var cc,cd;cc=[];for(var ce in cb)cc.push(cb[ce]);return cc;};r=q.Dictionary=b9.Class({set_Item:function(cb,cc){this.set(cb,cc);},ContainsKey:function(cb){var cc,cd;cc=this;cd=this.data[this.hash(cb)];return cd==null?false:J.exists(function(ce){return cc.equals.apply(null,[(m.KeyValue(ce))[0],cb]);},cd);},TryGetValue:function(cb,cc){var cd,ce,cf;cd=this;ce=this.data[this.hash(cb)];return ce==null?false:(cf=J.tryPick(function(cg){var ch;ch=m.KeyValue(cg);return cd.equals.apply(null,[ch[0],cb])?{$:1,$0:ch[1]}:null;},ce),cf!=null&&cf.$==1&&(cc.set(cf.$0),true));},Remove:function(cb){return this.remove(cb);},get_Keys:function(){return new bb.New(this);},set:function(cb,cc){var cd,ce,cf,cg;cd=this;ce=this.hash(cb);cf=this.data[ce];if(cf==null){this.count=this.count+1;this.data[ce]=new a.Array({K:cb,V:cc});}else{cg=J.tryFindIndex(function(ch){return cd.equals.apply(null,[(m.KeyValue(ch))[0],cb]);},cf);cg==null?(this.count=this.count+1,cf.push({K:cb,V:cc})):cf[cg.$0]={K:cb,V:cc};}},remove:function(cb){var cc,cd,ce,cf;cc=this;cd=this.hash(cb);ce=this.data[cd];return ce==null?false:(cf=J.filter(function(cg){return!cc.equals.apply(null,[(m.KeyValue(cg))[0],cb]);},ce),J.length(cf)<ce.length&&(this.count=this.count-1,this.data[cd]=cf,true));},get_Item:function(cb){return this.get(cb);},get:function(cb){var cc,cd;cc=this;cd=this.data[this.hash(cb)];return cd==null?_8.notPresent():J.pick(function(ce){var cf;cf=m.KeyValue(ce);return cc.equals.apply(null,[cf[0],cb])?{$:1,$0:cf[1]}:null;},cd);},Clear:function(){this.data=[];this.count=0;},get_Values:function(){return new b4.New(this);},GetEnumerator:function(){return ba.Get0(this);},GetEnumerator0:function(){return ba.Get0(J.concat(p.GetFieldValues(this.data)));}},h,r);r.New$5=b9.Ctor(function(){r.New$6.call(this,[],s.Equals,s.Hash);},r);r.New$6=b9.Ctor(function(cb,cc,cd){var ce,cf;h.New.call(this);this.equals=cc;this.hash=cd;this.count=0;this.data=[];ce=ba.Get(cb);try{while(ce.MoveNext()){cf=ce.Current();this.set(cf.K,cf.V);}}finally{if(typeof ce=="object"&&"Dispose"in ce)ce.Dispose();}},r);s.Equals=function(cb,cc){var cd,ce,cf,cg;if(cb===cc)return true;else{cd=typeof cb;if(cd=="object"){if(cb===null||cb===void 0||cc===null||cc===void 0||!s.Equals(typeof cc,"object"))return false;else if("Equals"in cb)return cb.Equals(cc);else if("Equals"in cc)return false;else if(cb instanceof a.Array&&cc instanceof a.Array)return s.arrayEquals(cb,cc);else if(cb instanceof a.Date&&cc instanceof a.Date)return s.dateEquals(cb,cc);else{ce=[true];for(var ch in cb)if(function(ci){ce[0]=!cb.hasOwnProperty(ci)||cc.hasOwnProperty(ci)&&s.Equals(cb[ci],cc[ci]);return!ce[0];}(ch))break;if(ce[0]){for(var ci in cc)if(function(cj){ce[0]=!cc.hasOwnProperty(cj)||cb.hasOwnProperty(cj);return!ce[0];}(ci))break;}return ce[0];}}else return cd=="function"&&("$Func"in cb?cb.$Func===cc.$Func&&cb.$Target===cc.$Target:"$Invokes"in cb&&"$Invokes"in cc&&s.arrayEquals(cb.$Invokes,cc.$Invokes));}};s.arrayEquals=function(cb,cc){var cd,ce;if(J.length(cb)===J.length(cc)){cd=true;ce=0;while(cd&&ce<J.length(cb)){!s.Equals(J.get(cb,ce),J.get(cc,ce))?cd=false:void 0;ce=ce+1;}return cd;}else return false;};s.dateEquals=function(cb,cc){return cb.getTime()===cc.getTime();};s.Hash=function(cb){var cc;cc=typeof cb;return cc=="function"?0:cc=="boolean"?cb?1:0:cc=="number"?cb:cc=="string"?s.hashString(cb):cc=="object"?cb==null?0:cb instanceof a.Array?s.hashArray(cb):s.hashObject(cb):0;};s.hashString=function(cb){var cc,cd,ce;if(cb===null)return 0;else{cc=5381;for(cd=0,ce=cb.length-1;cd<=ce;cd++)cc=s.hashMix(cc,cb[cd].charCodeAt());return cc;}};s.hashArray=function(cb){var cc,cd,ce;cc=-34948909;for(cd=0,ce=J.length(cb)-1;cd<=ce;cd++)cc=s.hashMix(cc,s.Hash(J.get(cb,cd)));return cc;};s.hashObject=function(cb){var cc,cd;if("GetHashCode"in cb)return cb.GetHashCode();else{cc=[0];for(var ce in cb)if(function(cf){cc[0]=s.hashMix(s.hashMix(cc[0],s.hashString(cf)),s.Hash(cb[cf]));return false;}(ce))break;return cc[0];}};s.hashMix=function(cb,cc){return(cb<<5)+cb+cc;};s.Compare=function(cb,cc){var cd,ce,cf,cg,ch,ci;if(cb===cc)return 0;else{ce=typeof cb;switch(ce=="function"?1:ce=="boolean"?2:ce=="number"?2:ce=="string"?2:ce=="object"?3:0){case 0:return typeof cc=="undefined"?0:-1;case 1:return m.FailWith("Cannot compare function values.");case 2:return cb<cc?-1:1;case 3:if(cb===null)cf=-1;else if(cc===null)cf=1;else if("CompareTo"in cb)cf=cb.CompareTo(cc);else if("CompareTo0"in cb)cf=cb.CompareTo0(cc);else if(cb instanceof a.Array&&cc instanceof a.Array)cf=s.compareArrays(cb,cc);else if(cb instanceof a.Date&&cc instanceof a.Date)cf=s.compareDates(cb,cc);else{cg=[0];for(var cj in cb)if(function(ck){return!cb.hasOwnProperty(ck)?false:!cc.hasOwnProperty(ck)?(cg[0]=1,true):(cg[0]=s.Compare(cb[ck],cc[ck]),cg[0]!==0);}(cj))break;if(cg[0]===0){for(var ck in cc)if(function(cl){return!cc.hasOwnProperty(cl)?false:!cb.hasOwnProperty(cl)&&(cg[0]=-1,true);}(ck))break;}cf=cg[0];}return cf;}}};s.compareArrays=function(cb,cc){var cd,ce;if(J.length(cb)<J.length(cc))return -1;else if(J.length(cb)>J.length(cc))return 1;else{cd=0;ce=0;while(cd===0&&ce<J.length(cb)){cd=s.Compare(J.get(cb,ce),J.get(cc,ce));ce=ce+1;}return cd;}};s.compareDates=function(cb,cc){return s.Compare(cb.getTime(),cc.getTime());};u.Create=function(cb,cc){return S.New$1(function(cd){var ce;ce=cc(cd.Segments);return ce==null?[]:[[T.New(w.Empty,cd.QueryArgs,cd.FormData,cd.Method,cd.Body),ce.$0]];},function(cd){return{$:1,$0:[T.Segment$1(cb(cd))]};});};u.Parse=function(cb,cc){function cd(ce,cf){return ce.Segments.$==0?{$:1,$0:cf}:null;}return P.tryPick(function(ce){return cd(ce[0],ce[1]);},cb.Parse(cc));};u.Link=function(cb,cc){var cd;cd=u.Write(cb,cc);return cd==null?"":cd.$0.ToLink();};u.Write=function(cb,cc){var cd;cd=cb.Write(cc);return cd==null?null:{$:1,$0:T.Combine(cd.$0)};};v.ofArray=function(cb){var cc,cd,ce;cc=w.Empty;for(cd=J.length(cb)-1,ce=0;cd>=ce;cd--)cc=new w({$:1,$0:J.get(cb,cd),$1:cc});return cc;};v.ofSeq=function(cb){var cc,cd,ce,cf,cg,ch;if(cb instanceof w)return cb;else if(cb instanceof a.Array)return v.ofArray(cb);else{cc=ba.Get(cb);try{ce=cc.MoveNext();if(!ce)cd=w.Empty;else{cg=new w({$:1});cf=cg;while(ce){cf.$0=cc.Current();if(cc.MoveNext())cf=(ch=new w({$:1}),cf.$1=ch,ch);else ce=false;}cf.$1=w.Empty;cd=cg;}return cd;}finally{if(typeof cc=="object"&&"Dispose"in cc)cc.Dispose();}}};v.head=function(cb){return cb.$==1?cb.$0:v.listEmpty();};v.tail=function(cb){return cb.$==1?cb.$1:v.listEmpty();};v.iter=function(cb,cc){var cd;cd=cc;while(cd.$==1){cb(v.head(cd));cd=v.tail(cd);}};v.listEmpty=function(){return m.FailWith("The input list was empty.");};w=v.T=b9.Class({GetEnumerator:function(){return new bF.New(this,null,function(cb){var cc;cc=cb.s;return cc.$==0?false:(cb.c=cc.$0,cb.s=cc.$1,true);},void 0);},GetEnumerator0:function(){return ba.Get(this);}},null,w);w.Empty=new w({$:0});x.Active={$:1};x.Completed={$:2};x.All={$:0};y.Create=function(cb,cc){return y.CreateWithStorage(cb,U.InMemory(J.ofSeq(cc)));};y.CreateWithStorage=function(cb,cc){return new y.New(cb,cc);};z.New=function(cb,cc,cd,ce){return{Id:cb,Text:cc,IsDone:cd,IsEditing:ce};};A.Install=function(cb,cc){var cd;cd=B.Create$1(void 0);A.InstallInto(cd,cb,cc);return cd;};A.InstallInto=function(cb,cc,cd){function ce(ch){return u.Parse(cd,ch);}function cf(){return A.getCurrent(ce,cc);}function cg(ch){if(!s.Equals(cb.Get(),ch))cb.Set(ch);}cg(cf());self.addEventListener("popstate",function(){return cg(cf());},false);self.document.body.addEventListener("click",function(ch){var ci,cj,ck;ci=(cj=(ck=A.findLinkHref(ch.target),ck==null?null:A.hrefToAbsolute(ck.$0)),cj==null?null:ce(T.FromUrl(cj.$0,null)));return ci==null?null:(cg(ci.$0),ch.preventDefault());},false);D.Sink(function(ch){var ci;if(!s.Equals(ch,cf())){ci=u.Link(cd,ch);self.history.pushState(null,null,ci);}},cb.get_View());};A.getCurrent=function(cb,cc){var cd,ce,cf;cd=self.location;ce=T.FromUrl(cd.pathname+cd.search,null);cf=cb(ce);return cf==null?((function(cg){return function(ch){return cg("Failed to parse route: "+bD.toSafe(ch));};}(function(cg){b_.log(cg);}))(ce.ToLink()),cc):cf.$0;};A.findLinkHref=function(cb){while(true)if(cb.tagName==="A")return _4.ofObj(cb.getAttribute("href"));else if(cb===self.document.body)return null;else cb=cb.parentNode;};A.hrefToAbsolute=function(cb){var cc;return _7.StartsWith(cb,"?")?{$:1,$0:A.trimFragment(self.location.pathname+cb)}:_7.StartsWith(cb,"#")?null:_7.StartsWith(cb,"/")?{$:1,$0:A.trimFragment(cb)}:(new a.RegExp("^[a-zA-Z0-9]:")).test(cb)?null:(cc=self.location.pathname,{$:1,$0:A.trimFragment($.string(cc,null,{$:1,$0:cc.lastIndexOf("/")})+cb)});};A.trimFragment=function(cb){var cc;cc=cb.indexOf("#");return cc===-1?cb:$.string(cb,null,{$:1,$0:cc-1});};B=e.Var$1=b9.Class({},h,B);B.Create$1=function(cb){return new W.New(false,X.New({$:2,$0:cb,$1:[]}),cb);};B.Set=function(cb,cc){cb.Set(cc);};B.Lens=function(cb,cc,cd){var ce,cf,cg;ce=bk.Id();cf=D.Map(cc,cb.get_View());cg=new E({Get:function(){return cc(cb.Get());},Set:function(ch){return cb.Update(function(ci){return cd(ci,ch);});},SetFinal:function(ch){return this.Set(ch);},Update:function(ch){return cb.Update(function(ci){return cd(ci,ch(cc(ci)));});},UpdateMaybe:function(ch){return cb.UpdateMaybe(function(ci){var cj;cj=ch(cc(ci));return cj==null?null:{$:1,$0:cd(ci,cj.$0)};});},get_View:function(){return cf;},get_Id:function(){return ce;}});E.New.call(cg);return cg;};C.DynamicClassPred=function(cb,cc){return Y.Dynamic(cc,function(cd){return function(ce){return ce?Z.AddClass(cd,cb):Z.RemoveClass(cd,cb);};});};C.Handler=function(cb,cc){return Y.Static(function(cd){cd.addEventListener(cb,function(ce){return(cc(cd))(ce);},false);});};C.Checked=function(cb){var cc;cc=(((bG.BoolCheckedApply())(cb))(Y.Static))(function(cd){return C.DynamicCustom(cd,cb.get_View());});return _3.Append(cc[0],cc[1]);};C.HandlerView=function(cb,cc,cd){return Y.Static(function(ce){var cf;cf=cd(ce);ce.addEventListener(cb,function(cg){return D.Get(cf(cg),cc);},false);});};C.OnAfterRender=function(cb){return new _3({$:4,$0:cb});};C.DynamicCustom=function(cb,cc){return Y.Dynamic(cc,cb);};C.Value=function(cb){var cc;cc=(((bG.StringApply())(cb))(Y.Static))(function(cd){return C.DynamicCustom(cd,cb.get_View());});return _3.Append(cc[0],cc[1]);};C.IntValue=function(cb){var cc;cc=(((bG.IntApplyChecked())(cb))(Y.Static))(function(cd){return C.DynamicCustom(cd,cb.get_View());});return _3.Append(cc[0],cc[1]);};C.IntValueUnchecked=function(cb){var cc;cc=(((bG.IntApplyUnchecked())(cb))(Y.Static))(function(cd){return C.DynamicCustom(cd,cb.get_View());});return _3.Append(cc[0],cc[1]);};C.FloatValue=function(cb){var cc;cc=(((bG.FloatApplyChecked())(cb))(Y.Static))(function(cd){return C.DynamicCustom(cd,cb.get_View());});return _3.Append(cc[0],cc[1]);};C.FloatValueUnchecked=function(cb){var cc;cc=(((bG.FloatApplyUnchecked())(cb))(Y.Static))(function(cd){return C.DynamicCustom(cd,cb.get_View());});return _3.Append(cc[0],cc[1]);};C.Dynamic=function(cb,cc){return Y.Dynamic(cc,function(cd){return function(ce){return cd.setAttribute(cb,ce);};});};D=e.View=b9.Class({},null,D);E=e.Var=b9.Class({},h,E);E.New=b9.Ctor(function(){h.New.call(this);},E);I=H.TemplateInstance=b9.Class({get_Doc:function(){return this.doc;}},h,I);I.New=b9.Ctor(function(cb,cc){h.New.call(this);this.doc=cc;this.allVars=cb.$==0?cb.$0:m.FailWith("Should not happen");},I);J.get=function(cb,cc){J.checkBounds(cb,cc);return cb[cc];};J.length=function(cb){return cb.dims===2?cb.length*cb.length:cb.length;};J.checkBounds=function(cb,cc){if(cc<0||cc>=cb.length)m.FailWith("Index was outside the bounds of the array.");};J.set=function(cb,cc,cd){J.checkBounds(cb,cc);cb[cc]=cd;};K=H.ProviderBuilder=b9.Class({},h,K);K.New$1=b9.Ctor(function(){var cb;h.New.call(this);this.i=null;this.k=(cb=_1.NewGuid(),a.String(cb));this.h=[];b9.SetOptional(this,"s",null);},K);L.EventQ2=function(cb,cc,cd,ce){return{$:5,$0:cc,$1:function(cf){return function(cg){return ce({Vars:cd(),Target:cf,Event:cg});};}};};L.CompleteHoles=function(cb,cc,cd){var cf,cg,ch,ci,cj;function ce(ck,cl){var cm;return cg.Contains(ck)?null:(cm=s.Equals(cl,0)?bp.GetOrAddHoleFor(cb,ck,function(){return{$:8,$0:ck,$1:B.Create$1("")};}):s.Equals(cl,1)?bp.GetOrAddHoleFor(cb,ck,function(){return{$:13,$0:ck,$1:B.Create$1(0)};}):s.Equals(cl,2)?bp.GetOrAddHoleFor(cb,ck,function(){return{$:9,$0:ck,$1:B.Create$1(false)};}):m.FailWith("Invalid value type"),(cf.set_Item(ck,cm),{$:1,$0:cm}));}cf=new r.New$5();cg=new O.New$3();ch=ba.Get(cc);try{while(ch.MoveNext()){ci=ch.Current();cj=ci.$0;cg.Add(cj);cf.set_Item(cj,ci);}}finally{if(typeof ch=="object"&&"Dispose"in ch)ch.Dispose();}return[P.append(cc,J.choose(function(ck){return ce(ck[0],ck[1]);},cd)),{$:0,$0:cf}];};D.Map=function(cb,cc){return D.CreateLazy(function(){return X.Map(cb,cc());});};D.CreateLazy=function(cb){var cc;cc={c:null,o:cb};return function(){var cd,ce;cd=cc.c;return cd===null?(cd=cc.o(),cc.c=cd,(ce=cd.s,ce!=null&&ce.$==0)?cc.o=null:X.WhenObsoleteRun(cd,function(){cc.c=null;}),cd):cd;};};D.Const=function(cb){var cc;cc=X.New({$:0,$0:cb});return function(){return cc;};};D.Sink=function(cb,cc){function cd(){X.WhenRun(cc(),cb,function(){bv.scheduler().Fork(cd);});}bv.scheduler().Fork(cd);};D.Map2=function(cb,cc,cd){return D.CreateLazy(function(){return X.Map2(cb,cc(),cd());});};D.Bind=function(cb,cc){return D.Join(D.Map(cb,cc));};D.Join=function(cb){return D.CreateLazy(function(){return X.Join(cb());});};D.Map2Unit=function(cb,cc){return D.CreateLazy(function(){return X.Map2Unit(cb(),cc());});};D.MapSeqCachedViewBy=function(cb,cc,cd){var ce;ce=[new r.New$5()];return D.Map(function(cf){var cg,ch,ci;cg=ce[0];ch=new r.New$5();ci=bo.mapInPlace(function(cj){var ck,cl,cm;ck=cb(cj);cl=cg.ContainsKey(ck)?(cm=cg.get_Item(ck),(B.Set(cm.r,cj),cm)):D.ConvertSeqNode(function(cn){return cc(ck,cn);},cj);ch.set_Item(ck,cl);return cl.e;},J.ofSeq(cf));ce[0]=ch;return ci;},cd);};D.Get=function(cb,cc){var cd;function ce(){X.WhenRun(cc(),function(cf){if(!cd[0]){cd[0]=true;cb(cf);}},function(){if(!cd[0])ce();});}cd=[false];ce();};D.ConvertSeqNode=function(cb,cc){var cd,ce;cd=B.Create$1(cc);ce=cd.get_View();return{e:cb(ce),r:cd,w:ce};};D.Map3=function(cb,cc,cd,ce){return D.CreateLazy(function(){return X.Map3(cb,cc(),cd(),ce());});};D.Sequence=function(cb){return D.CreateLazy(function(){return X.Sequence(P.map(function(cc){return cc();},cb));});};M.footertemplate=function(cb){return cb?g.GetOrLoadTemplate("todoapp",{$:1,$0:"footertemplate"},function(){return Z.ParseHTMLIntoFakeRoot("<footer class=\"footer\">\r\n            <span class=\"todo-count\">\r\n                <strong>${Remaining}</strong>\r\n                ${RemainingLabel} left\r\n            </span>\r\n            <ul class=\"filters\" ws-hole=\"Filters\"></ul>\r\n            <span ws-replace=\"ClearCompleted\"></span>\r\n        </footer>");},cb):g.PrepareTemplate("todoapp",{$:1,$0:"footertemplate"},function(){return Z.ParseHTMLIntoFakeRoot("<footer class=\"footer\">\r\n            <span class=\"todo-count\">\r\n                <strong>${Remaining}</strong>\r\n                ${RemainingLabel} left\r\n            </span>\r\n            <ul class=\"filters\" ws-hole=\"Filters\"></ul>\r\n            <span ws-replace=\"ClearCompleted\"></span>\r\n        </footer>");});};M.t=function(cb){return cb?g.GetOrLoadTemplate("todoapp",null,function(){return Z.ParseHTMLIntoFakeRoot("<section class=\"todoapp\" ws-chidlren-template=\"TodoApp\">\r\n    <header class=\"header\">\r\n        <h1>todos</h1>\r\n        <input class=\"new-todo\" ws-var=\"NewTask\" ws-onkeydown=\"Add\" placeholder=\"What needs to be done?\" autofocus=\"\">\r\n    </header>\r\n    <section class=\"main\">\r\n        <span ws-replace=\"ToggleAll\"></span>\r\n        <label for=\"toggle-all\">Mark all as complete</label>\r\n        <ul class=\"todo-list\" ws-hole=\"TodoList\">\r\n            \r\n        </ul>\r\n    </section>\r\n    <div ws-replace=\"Footer\">\r\n        \r\n    </div>\r\n</section>\r\n<footer class=\"info\">\r\n    <p>Double-click to edit a todo</p>\r\n    <p>Written by <a href=\"https://github.com/SimonJF\">Simon Fowler</a> and <a href=\"https://github.com/qwe2\">István Gansperger</a></p>\r\n</footer>");},cb):g.PrepareTemplate("todoapp",null,function(){return Z.ParseHTMLIntoFakeRoot("<section class=\"todoapp\" ws-chidlren-template=\"TodoApp\">\r\n    <header class=\"header\">\r\n        <h1>todos</h1>\r\n        <input class=\"new-todo\" ws-var=\"NewTask\" ws-onkeydown=\"Add\" placeholder=\"What needs to be done?\" autofocus=\"\">\r\n    </header>\r\n    <section class=\"main\">\r\n        <span ws-replace=\"ToggleAll\"></span>\r\n        <label for=\"toggle-all\">Mark all as complete</label>\r\n        <ul class=\"todo-list\" ws-hole=\"TodoList\">\r\n            \r\n        </ul>\r\n    </section>\r\n    <div ws-replace=\"Footer\">\r\n        \r\n    </div>\r\n</section>\r\n<footer class=\"info\">\r\n    <p>Double-click to edit a todo</p>\r\n    <p>Written by <a href=\"https://github.com/SimonJF\">Simon Fowler</a> and <a href=\"https://github.com/qwe2\">István Gansperger</a></p>\r\n</footer>");});};M.listitem=function(cb){return cb?g.GetOrLoadTemplate("todoapp",{$:1,$0:"listitem"},function(){return Z.ParseHTMLIntoFakeRoot("<li class=\"${ItemState}\">\r\n                <div class=\"view\">\r\n                    <input class=\"toggle\" ws-var=\"Checked\" type=\"checkbox\">\r\n                    <label ws-ondblclick=\"Edit\">${Title}</label>\r\n                    <button class=\"destroy\" ws-onclick=\"Destroy\"></button>\r\n                </div>\r\n                <div ws-replace=\"TitleEditing\"></div>\r\n            </li>");},cb):g.PrepareTemplate("todoapp",{$:1,$0:"listitem"},function(){return Z.ParseHTMLIntoFakeRoot("<li class=\"${ItemState}\">\r\n                <div class=\"view\">\r\n                    <input class=\"toggle\" ws-var=\"Checked\" type=\"checkbox\">\r\n                    <label ws-ondblclick=\"Edit\">${Title}</label>\r\n                    <button class=\"destroy\" ws-onclick=\"Destroy\"></button>\r\n                </div>\r\n                <div ws-replace=\"TitleEditing\"></div>\r\n            </li>");});};y=e.ListModel=b9.Class({UpdateAll:function(cb){var cc;cc=this;this["var"].Update(function(cd){J.iteri(function(ce,cf){var cg;cg=cb(cf);return cg==null?null:J.set(cd,ce,cg.$0);},cd);return cc.storage.SSet(cd);});this.ObsoleteAll();},TryFind:function(cb){return J.tryFind(cb,this["var"].Get());},RemoveBy:function(cb){var cc,cd,ce,cf;cc=this["var"].Get();for(cd=0,ce=cc.length-1;cd<=ce;cd++){cf=J.get(cc,cd);if(cb(cf))this.ObsoleteKey(this.key(cf));}this["var"].Set(this.storage.SRemoveIf(cb,this["var"].Get()));},Append:function(cb){var cc,cd,ce,cf;cc=this;cd=this["var"].Get();ce=this.key(cb);cf=J.tryFindIndex(function(cg){return s.Equals(cc.key(cg),ce);},cd);if(cf!=null&&cf.$==1)this["var"].Set(this.storage.SSetAt(cf.$0,cb,cd));else this["var"].Set(this.storage.SAppend(cb,cd));this.ObsoleteKey(ce);},RemoveByKey:function(cb){var cc;cc=this;this["var"].Set(this.storage.SRemoveIf(function(cd){return s.Equals(cc.key(cd),cb);},this["var"].Get()));this.ObsoleteKey(cb);},ObsoleteAll:function(){P.iter(function(cb){X.Obsolete(cb.V);},this.it);this.it.Clear();},ObsoleteKey:function(cb){var cc,cd;cc=(cd=null,[this.it.TryGetValue(cb,{get:function(){return cd;},set:function(ce){cd=ce;}}),cd]);if(cc[0]){X.Obsolete(cc[1]);this.it.Remove(cb);}},MapLens:function(cb){var cc;cc=this;return D.MapSeqCachedViewBy(cc.key,function(cd,ce){return cb(cd,cc["LensInto'"](a.id,function(cf,cg){return cg;},cd,ce));},this["var"].get_View());},"LensInto'":function(cb,cc,cd,ce){var cf,cg,ch;cf=this;cg=bk.Id();ch=new E({Get:function(){return cb(cf.FindByKey(cd));},Set:function(ci){return cf.UpdateBy(function(cj){return{$:1,$0:cc(cj,ci)};},cd);},SetFinal:function(ci){return this.Set(ci);},Update:function(ci){return cf.UpdateBy(function(cj){return{$:1,$0:cc(cj,ci(cb(cj)))};},cd);},UpdateMaybe:function(ci){return cf.UpdateBy(function(cj){var ck;ck=ci(cb(cj));return ck==null?null:{$:1,$0:cc(cj,ck.$0)};},cd);},get_View:function(){return ce;},get_Id:function(){return cg;}});E.New.call(ch);return ch;},FindByKey:function(cb){var cc;cc=this;return J.find(function(cd){return s.Equals(cc.key(cd),cb);},this["var"].Get());},UpdateBy:function(cb,cc){var cd,ce,cf,cg,ch;cd=this;ce=this["var"].Get();cf=J.tryFindIndex(function(ci){return s.Equals(cd.key(ci),cc);},ce);if(cf!=null&&cf.$==1){cg=cf.$0;ch=cb(J.get(ce,cg));ch!=null&&ch.$==1?(this["var"].Set(this.storage.SSetAt(cg,ch.$0,ce)),this.ObsoleteKey(cc)):void 0;}},GetEnumerator:function(){return ba.Get(this["var"].Get());},GetEnumerator0:function(){return ba.Get0(this["var"].Get());}},h,y);y.New=b9.Ctor(function(cb,cc){y.New$3.call(this,cb,B.Create$1(J.ofSeq(P.distinctBy(cb,cc.SInit()))),cc);},y);y.New$3=b9.Ctor(function(cb,cc,cd){h.New.call(this);this.key=cb;this["var"]=cc;this.storage=cd;this.v=D.Map(function(ce){return ce.slice();},this["var"].get_View());this.it=new r.New$5();},y);N.$cctor=function(){N.$cctor=a.ignore;N.LoadedTemplates=new r.New$5();N.LocalTemplatesLoaded=false;N.GlobalHoles=new r.New$5();N.TextHoleRE="\\${([^}]+)}";N.RenderedFullDocTemplate=null;};O=q.HashSet=b9.Class({Add:function(cb){return this.add(cb);},Contains:function(cb){var cc;cc=this.data[this.hash(cb)];return cc==null?false:this.arrContains(cb,cc);},add:function(cb){var cc,cd;cc=this.hash(cb);cd=this.data[cc];return cd==null?(this.data[cc]=[cb],this.count=this.count+1,true):this.arrContains(cb,cd)?false:(cd.push(cb),this.count=this.count+1,true);},arrContains:function(cb,cc){var cd,ce,cf,cg;cd=true;ce=0;cg=cc.length;while(cd&&ce<cg)if(this.equals.apply(null,[cc[ce],cb]))cd=false;else ce=ce+1;return!cd;},ExceptWith:function(cb){var cc;cc=ba.Get(cb);try{while(cc.MoveNext())this.Remove(cc.Current());}finally{if(typeof cc=="object"&&"Dispose"in cc)cc.Dispose();}},get_Count:function(){return this.count;},CopyTo:function(cb){var cc,cd,ce,cf;cc=0;cd=bR.concat(this.data);for(ce=0,cf=cd.length-1;ce<=cf;ce++)J.set(cb,ce,cd[ce]);},IntersectWith:function(cb){var cc,cd,ce,cf,cg;cc=new O.New$4(cb,this.equals,this.hash);cd=bR.concat(this.data);for(ce=0,cf=cd.length-1;ce<=cf;ce++){cg=cd[ce];if(!cc.Contains(cg))this.Remove(cg);}},Remove:function(cb){var cc;cc=this.data[this.hash(cb)];return cc==null?false:this.arrRemove(cb,cc)&&(this.count=this.count-1,true);},arrRemove:function(cb,cc){var cd,ce,cf,cg;cd=true;ce=0;cg=cc.length;while(cd&&ce<cg)if(this.equals.apply(null,[cc[ce],cb])){cc.splice.apply(cc,[ce,1]);cd=false;}else ce=ce+1;return!cd;},GetEnumerator:function(){return ba.Get(bR.concat(this.data));},GetEnumerator0:function(){return ba.Get(bR.concat(this.data));}},h,O);O.New$3=b9.Ctor(function(){O.New$4.call(this,[],s.Equals,s.Hash);},O);O.New$4=b9.Ctor(function(cb,cc,cd){var ce;h.New.call(this);this.equals=cc;this.hash=cd;this.data=[];this.count=0;ce=ba.Get(cb);try{while(ce.MoveNext())this.add(ce.Current());}finally{if(typeof ce=="object"&&"Dispose"in ce)ce.Dispose();}},O);O.New$2=b9.Ctor(function(cb){O.New$4.call(this,cb,s.Equals,s.Hash);},O);P.head=function(cb){var cc;cc=ba.Get(cb);try{return cc.MoveNext()?cc.Current():P.insufficient();}finally{if(typeof cc=="object"&&"Dispose"in cc)cc.Dispose();}};P.sumBy=function(cb,cc){return P.fold(function(cd,ce){return cd+cb(ce);},0,cc);};P.isEmpty=function(cb){var cc;cc=ba.Get(cb);try{return!cc.MoveNext();}finally{if(typeof cc=="object"&&"Dispose"in cc)cc.Dispose();}};P.exists=function(cb,cc){var cd,ce;cd=ba.Get(cc);try{ce=false;while(!ce&&cd.MoveNext())ce=cb(cd.Current());return ce;}finally{if(typeof cd=="object"&&"Dispose"in cd)cd.Dispose();}};P.tryPick=function(cb,cc){var cd,ce;cd=ba.Get(cc);try{ce=null;while(s.Equals(ce,null)&&cd.MoveNext())ce=cb(cd.Current());return ce;}finally{if(typeof cd=="object"&&"Dispose"in cd)cd.Dispose();}};P.fold=function(cb,cc,cd){var ce,cf;ce=cc;cf=ba.Get(cd);try{while(cf.MoveNext())ce=cb(ce,cf.Current());return ce;}finally{if(typeof cf=="object"&&"Dispose"in cf)cf.Dispose();}};P.delay=function(cb){return{GetEnumerator:function(){return ba.Get(cb());}};};P.append=function(cb,cc){return{GetEnumerator:function(){var cd,ce;cd=ba.Get(cb);ce=[true];return new bF.New(cd,null,function(cf){var cg;return cf.s.MoveNext()?(cf.c=cf.s.Current(),true):(cg=cf.s,!s.Equals(cg,null)?cg.Dispose():void 0,cf.s=null,ce[0]&&(ce[0]=false,cf.s=ba.Get(cc),cf.s.MoveNext()?(cf.c=cf.s.Current(),true):(cf.s.Dispose(),cf.s=null,false)));},function(cf){var cg;cg=cf.s;if(!s.Equals(cg,null))cg.Dispose();});}};};P.distinctBy=function(cb,cc){return{GetEnumerator:function(){var cd,ce;cd=ba.Get(cc);ce=new O.New$3();return new bF.New(null,null,function(cf){var cg,ch;if(cd.MoveNext()){cg=cd.Current();ch=ce.Add(cb(cg));while(!ch&&cd.MoveNext()){cg=cd.Current();ch=ce.Add(cb(cg));}return ch&&(cf.c=cg,true);}else return false;},function(){cd.Dispose();});}};};P.iter=function(cb,cc){var cd;cd=ba.Get(cc);try{while(cd.MoveNext())cb(cd.Current());}finally{if(typeof cd=="object"&&"Dispose"in cd)cd.Dispose();}};P.forall2=function(cb,cc,cd){return!P.exists2(function(ce,cf){return!cb(ce,cf);},cc,cd);};P.exists2=function(cb,cc,cd){var ce,cf,cg,ch;ce=ba.Get(cc);try{cg=ba.Get(cd);try{ch=false;while(!ch&&ce.MoveNext()&&cg.MoveNext())ch=cb(ce.Current(),cg.Current());cf=ch;}finally{if(typeof cg=="object"&&"Dispose"in cg)cg.Dispose();}return cf;}finally{if(typeof ce=="object"&&"Dispose"in ce)ce.Dispose();}};P.map=function(cb,cc){return{GetEnumerator:function(){var cd;cd=ba.Get(cc);return new bF.New(null,null,function(ce){return cd.MoveNext()&&(ce.c=cb(cd.Current()),true);},function(){cd.Dispose();});}};};P.max=function(cb){var cc,cd,ce;cc=ba.Get(cb);try{if(!cc.MoveNext())P.seqEmpty();cd=cc.Current();while(cc.MoveNext()){ce=cc.Current();if(s.Compare(ce,cd)===1)cd=ce;}return cd;}finally{if(typeof cc=="object"&&"Dispose"in cc)cc.Dispose();}};P.rev=function(cb){return P.delay(function(){return J.ofSeq(cb).slice().reverse();});};P.unfold=function(cb,cc){return{GetEnumerator:function(){return new bF.New(cc,null,function(cd){var ce;ce=cb(cd.s);return ce==null?false:(cd.c=ce.$0[0],cd.s=ce.$0[1],true);},void 0);}};};P.seqEmpty=function(){return m.FailWith("The input sequence was empty.");};P.distinct=function(cb){return P.distinctBy(a.id,cb);};P.forall=function(cb,cc){return!P.exists(function(cd){return!cb(cd);},cc);};P.compareWith=function(cb,cc,cd){var ce,cf,cg,ch,ci;ce=ba.Get(cc);try{cg=ba.Get(cd);try{ch=0;ci=true;while(ci&&ch===0)if(ce.MoveNext())ch=cg.MoveNext()?cb(ce.Current(),cg.Current()):1;else if(cg.MoveNext())ch=-1;else ci=false;cf=ch;}finally{if(typeof cg=="object"&&"Dispose"in cg)cg.Dispose();}return cf;}finally{if(typeof ce=="object"&&"Dispose"in ce)ce.Dispose();}};R.LinkElement=function(cb,cc){R.InsertDoc(cb,cc,null);};R.InsertDoc=function(cb,cc,cd){var ce,cf,cg;while(true)if(cc!=null&&cc.$==1)return R.InsertNode(cb,cc.$0.El,cd);else if(cc!=null&&cc.$==2){ce=cc.$0;ce.Dirty=false;cc=ce.Current;}else if(cc==null)return cd;else if(cc!=null&&cc.$==4)return R.InsertNode(cb,cc.$0.Text,cd);else if(cc!=null&&cc.$==5)return R.InsertNode(cb,cc.$0,cd);else if(cc!=null&&cc.$==6)return J.foldBack(function(ch,ci){return(((b9.Curried3(function(cj,ck,cl){return ck==null||ck.constructor===_9?R.InsertDoc(cj,ck,cl):R.InsertNode(cj,ck,cl);}))(cb))(ch))(ci);},cc.$0.Els,cd);else{cf=cc.$1;cg=cc.$0;cc=cg;cd=R.InsertDoc(cb,cf,cd);}};R.CreateRunState=function(cb,cc){return bt.New(bu.get_Empty(),R.CreateElemNode(cb,Y.EmptyAttr(),cc));};R.PerformAnimatedUpdate=function(cb,cc,cd){var ce;return be.get_UseAnimations()?(ce=null,bv.Delay(function(){var cf,cg,ch;cf=bu.FindAll(cd);cg=R.ComputeChangeAnim(cc,cf);ch=R.ComputeEnterAnim(cc,cf);return bv.Bind(be.Play(be.Append(cg,R.ComputeExitAnim(cc,cf))),function(){return bv.Bind(R.SyncElemNodesNextFrame(cb,cc),function(){return bv.Bind(be.Play(ch),function(){cc.PreviousNodes=cf;return bv.Return(null);});});});})):R.SyncElemNodesNextFrame(cb,cc);};R.PerformSyncUpdate=function(cb,cc,cd){var ce;ce=bu.FindAll(cd);R.SyncElemNode(cb,cc.Top);cc.PreviousNodes=ce;};R.CreateEmbedNode=function(){return{Current:null,Dirty:false};};R.UpdateEmbedNode=function(cb,cc){cb.Current=cc;cb.Dirty=true;};R.InsertNode=function(cb,cc,cd){Z.InsertAt(cb,cd,cc);return cc;};R.CreateElemNode=function(cb,cc,cd){var ce;R.LinkElement(cb,cd);ce=Y.Insert(cb,cc);return bc.New(ce,cd,null,cb,bk.Int(),b9.GetOptional(ce.OnAfterRender));};R.SyncElemNodesNextFrame=function(cb,cc){function cd(ce){a.requestAnimationFrame(function(){R.SyncElemNode(cb,cc.Top);ce();});}return bf.BatchUpdatesEnabled()?bv.FromContinuations(function(ce,cf,cg){return cd.apply(null,[ce,cf,cg]);}):(R.SyncElemNode(cb,cc.Top),bv.Return(null));};R.ComputeExitAnim=function(cb,cc){return be.Concat(J.map(function(cd){return Y.GetExitAnim(cd.Attr);},bu.ToArray(bu.Except(cc,bu.Filter(function(cd){return Y.HasExitAnim(cd.Attr);},cb.PreviousNodes)))));};R.ComputeEnterAnim=function(cb,cc){return be.Concat(J.map(function(cd){return Y.GetEnterAnim(cd.Attr);},bu.ToArray(bu.Except(cb.PreviousNodes,bu.Filter(function(cd){return Y.HasEnterAnim(cd.Attr);},cc)))));};R.ComputeChangeAnim=function(cb,cc){var cd;function ce(cf){return Y.HasChangeAnim(cf.Attr);}cd=function(cf){return bu.Filter(ce,cf);};return be.Concat(J.map(function(cf){return Y.GetChangeAnim(cf.Attr);},bu.ToArray(bu.Intersect(cd(cb.PreviousNodes),cd(cc)))));};R.SyncElemNode=function(cb,cc){!cb?R.SyncElement(cc):void 0;R.Sync(cc.Children);R.AfterRender(cc);};R.SyncElement=function(cb){function cc(cd){function ce(cf){var cg,ch,ci,cj;while(true){if(cf!=null&&cf.$==0){ch=cf.$1;ci=cf.$0;if(ce(ci))return true;else cf=ch;}else if(cf!=null&&cf.$==2){cj=cf.$0;if(cj.Dirty)return true;else cf=cj.Current;}else return cf!=null&&cf.$==6&&(cg=cf.$0,cg.Dirty||J.exists(cc,cg.Holes));}}return ce(cd.Children);}Y.Sync(cb.El,cb.Attr);if(cc(cb))R.DoSyncElement(cb);};R.Sync=function(cb){var cc,cd,ce,cf,cg;while(true){if(cb!=null&&cb.$==1)return R.SyncElemNode(false,cb.$0);else if(cb!=null&&cb.$==2){ce=cb.$0;cb=ce.Current;}else if(cb==null)return null;else if(cb!=null&&cb.$==5)return null;else if(cb!=null&&cb.$==4){cc=cb.$0;return cc.Dirty?(cc.Text.nodeValue=cc.Value,cc.Dirty=false):null;}else if(cb!=null&&cb.$==6){cd=cb.$0;J.iter(function(ch){return function(ci){R.SyncElemNode(ch,ci);};}(false),cd.Holes);J.iter(function(ch){Y.Sync(ch[0],ch[1]);},cd.Attrs);return R.AfterRender(cd);}else{cf=cb.$1;cg=cb.$0;R.Sync(cg);cb=cf;}}};R.AfterRender=function(cb){var cc;cc=b9.GetOptional(cb.Render);if(cc!=null&&cc.$==1){cc.$0(cb.El);b9.SetOptional(cb,"Render",null);}};R.DoSyncElement=function(cb){var cc,cd,ce;function cf(cg,ch){var ci,cj,ck,cl;while(true){if(cg!=null&&cg.$==1)return cg.$0.El;else if(cg!=null&&cg.$==2){cj=cg.$0;if(cj.Dirty){cj.Dirty=false;return R.InsertDoc(cc,cj.Current,ch);}else cg=cj.Current;}else if(cg==null)return ch;else if(cg!=null&&cg.$==4)return cg.$0.Text;else if(cg!=null&&cg.$==5)return cg.$0;else if(cg!=null&&cg.$==6){ci=cg.$0;ci.Dirty?ci.Dirty=false:void 0;return J.foldBack(function(cm,cn){return cm==null||cm.constructor===_9?cf(cm,cn):cm;},ci.Els,ch);}else{ck=cg.$1;cl=cg.$0;cg=cl;ch=cf(ck,ch);}}}cc=cb.El;b2.Iter((cd=cb.El,function(cg){Z.RemoveNode(cd,cg);}),b2.Except(b2.DocChildren(cb),b2.Children(cb.El,b9.GetOptional(cb.Delimiters))));cf(cb.Children,(ce=b9.GetOptional(cb.Delimiters),ce!=null&&ce.$==1?ce.$0[1]:null));};R.InsertBeforeDelim=function(cb,cc){var cd,ce;cd=cb.parentNode;ce=self.document.createTextNode("");cd.insertBefore(ce,cb);R.LinkPrevElement(cb,cc);return ce;};R.CreateTextNode=function(){return{Text:self.document.createTextNode(""),Dirty:false,Value:""};};R.UpdateTextNode=function(cb,cc){cb.Value=cc;cb.Dirty=true;};R.LinkPrevElement=function(cb,cc){R.InsertDoc(cb.parentNode,cc,cb);};S.New$1=function(cb,cc){return{Parse:cb,Write:cc};};T=t.Route=b9.Class({ToLink:function(){return bN.WriteLink(this.Segments,this.QueryArgs);}},null,T);T.Segment$1=function(cb){var cc;cc=T.get_Empty();return T.New(cb,cc.QueryArgs,cc.FormData,cc.Method,cc.Body);};T.get_Empty=function(){return T.New(w.Empty,new bi.New([]),new bi.New([]),null,bC.CreateFromValue(null));};T.FromUrl=function(cb,cc){var cd,ce,cf;cd=(ce=cb.indexOf("?"),ce===-1?[cb,new bi.New([])]:[_7.Substring(cb,0,ce),T.ParseQuery(cb.substring(ce+1))]);cf=T.get_Empty();return T.New(v.ofArray(_7.SplitChars(cd[0],["/"],cc!=null&&cc.$0?0:1)),cd[1],cf.FormData,cf.Method,cf.Body);};T.ParseQuery=function(cb){return bB.OfArray(J.ofSeq(J.choose(function(cc){var cd,ce;cd=_7.SplitChars(cc,["="],0);return!s.Equals(cd,null)&&cd.length===2?(ce=J.get(cd,1),{$:1,$0:[J.get(cd,0),ce]}):((function(cf){return function(cg){return cf("wrong format for query argument: "+bD.toSafe(cg));};}(function(cf){b_.log(cf);}))(cc),null);},_7.SplitChars(cb,["&"],0))));};T.Combine=function(cb){var cc,cd,ce,cf,cg,ch,ci;cc=J.ofSeq(cb);cd=J.length(cc);return cd===0?T.get_Empty():cd===1?J.get(cc,0):(ce=null,cf=null,cg=[],ch=new bi.New([]),ci=new bi.New([]),J.iter(function(cj){var ck,cl;ck=cj.Method;if(ck!=null&&ck.$==1)ce=ck;cl=cj.Body.f();if(cl===null);else cf=cl;ch=bB.FoldBack(function(cm,cn,co){return co.Add(cm,cn);},ch,cj.QueryArgs);ci=bB.FoldBack(function(cm,cn,co){return co.Add(cm,cn);},ci,cj.FormData);v.iter(function(cm){cg.push(cm);},cj.Segments);},cc),T.New(v.ofSeq(cg),ch,ci,ce,bC.CreateFromValue(cf)));};T.New=function(cb,cc,cd,ce,cf){return new T({Segments:cb,QueryArgs:cc,FormData:cd,Method:ce,Body:cf});};U.InMemory=function(cb){return new bj.New(cb);};V.TryParseInt32=function(cb,cc){return V.TryParse(cb,-2147483648,2147483647,cc);};W=e.ConcreteVar=b9.Class({get_View:function(){return this.view;},Set:function(cb){if(this.isConst)(function(cc){return cc("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(cc){b_.log(cc);}));else{X.Obsolete(this.snap);this.current=cb;this.snap=X.New({$:2,$0:cb,$1:[]});}},Get:function(){return this.current;},Update:function(cb){this.Set(cb(this.Get()));},UpdateMaybe:function(cb){var cc;cc=cb(this.Get());if(cc!=null&&cc.$==1)this.Set(cc.$0);}},E,W);W.New=b9.Ctor(function(cb,cc,cd){var ce;ce=this;E.New.call(this);this.isConst=cb;this.current=cd;this.snap=cc;this.view=function(){return ce.snap;};this.id=bk.Int();},W);X.Map=function(cb,cc){var cd,ce;cd=cc.s;return cd!=null&&cd.$==0?X.New({$:0,$0:cb(cd.$0)}):(ce=X.New({$:3,$0:[],$1:[]}),(X.When(cc,function(cf){X.MarkDone(ce,cc,cb(cf));},ce),ce));};X.WhenObsoleteRun=function(cb,cc){var cd;cd=cb.s;if(cd==null)cc();else cd!=null&&cd.$==2?cd.$1.push(cc):cd!=null&&cd.$==3?cd.$1.push(cc):void 0;};X.When=function(cb,cc,cd){var ce;ce=cb.s;if(ce==null)X.Obsolete(cd);else ce!=null&&ce.$==2?(X.EnqueueSafe(ce.$1,cd),cc(ce.$0)):ce!=null&&ce.$==3?(ce.$0.push(cc),X.EnqueueSafe(ce.$1,cd)):cc(ce.$0);};X.MarkDone=function(cb,cc,cd){var ce;if(ce=cc.s,ce!=null&&ce.$==0)X.MarkForever(cb,cd);else X.MarkReady(cb,cd);};X.WhenRun=function(cb,cc,cd){var ce;ce=cb.s;if(ce==null)cd();else ce!=null&&ce.$==2?(ce.$1.push(cd),cc(ce.$0)):ce!=null&&ce.$==3?(ce.$0.push(cc),ce.$1.push(cd)):cc(ce.$0);};X.Map2=function(cb,cc,cd){var ce,cf,cg;function ch(ci){var cj,ck,cl;if(!(cj=cg.s,cj!=null&&cj.$==0||cj!=null&&cj.$==2)){ck=X.ValueAndForever(cc);cl=X.ValueAndForever(cd);if(ck!=null&&ck.$==1)cl!=null&&cl.$==1?ck.$0[1]&&cl.$0[1]?X.MarkForever(cg,cb(ck.$0[0],cl.$0[0])):X.MarkReady(cg,cb(ck.$0[0],cl.$0[0])):void 0;}}ce=cc.s;cf=cd.s;return ce!=null&&ce.$==0?cf!=null&&cf.$==0?X.New({$:0,$0:cb(ce.$0,cf.$0)}):X.Map2Opt1(cb,ce.$0,cd):cf!=null&&cf.$==0?X.Map2Opt2(cb,cf.$0,cc):(cg=X.New({$:3,$0:[],$1:[]}),(X.When(cc,ch,cg),X.When(cd,ch,cg),cg));};X.EnqueueSafe=function(cb,cc){var cd,ce,cf,cg;cb.push(cc);if(cb.length%20===0){cd=cb.slice(0);bZ.Clear(cb);for(ce=0,cf=J.length(cd)-1;ce<=cf;ce++){cg=J.get(cd,ce);if(typeof cg=="object")(function(ch){if(ch.s)cb.push(ch);}(cg));else(function(ch){cb.push(ch);}(cg));}}else void 0;};X.MarkForever=function(cb,cc){var cd,ce,cf,cg;cd=cb.s;if(cd!=null&&cd.$==3){cb.s={$:0,$0:cc};ce=cd.$0;for(cf=0,cg=J.length(ce)-1;cf<=cg;cf++)(J.get(ce,cf))(cc);}else void 0;};X.MarkReady=function(cb,cc){var cd,ce,cf,cg;cd=cb.s;if(cd!=null&&cd.$==3){cb.s={$:2,$0:cc,$1:cd.$1};ce=cd.$0;for(cf=0,cg=J.length(ce)-1;cf<=cg;cf++)(J.get(ce,cf))(cc);}else void 0;};X.Map2Opt1=function(cb,cc,cd){return X.Map(function(ce){return cb(cc,ce);},cd);};X.Map2Opt2=function(cb,cc,cd){return X.Map(function(ce){return cb(ce,cc);},cd);};X.ValueAndForever=function(cb){var cc;cc=cb.s;return cc!=null&&cc.$==0?{$:1,$0:[cc.$0,true]}:cc!=null&&cc.$==2?{$:1,$0:[cc.$0,false]}:null;};X.Join=function(cb){var cc;cc=X.New({$:3,$0:[],$1:[]});X.When(cb,function(cd){var ce;ce=cd();X.When(ce,function(cf){var cg,ch;if((cg=ce.s,cg!=null&&cg.$==0)&&(ch=cb.s,ch!=null&&ch.$==0))X.MarkForever(cc,cf);else X.MarkReady(cc,cf);},cc);},cc);return cc;};X.Map2Unit=function(cb,cc){var cd,ce,cf;function cg(){var ch,ci,cj;if(!(ch=cf.s,ch!=null&&ch.$==0||ch!=null&&ch.$==2)){ci=X.ValueAndForever(cb);cj=X.ValueAndForever(cc);if(ci!=null&&ci.$==1)cj!=null&&cj.$==1?ci.$0[1]&&cj.$0[1]?X.MarkForever(cf,null):X.MarkReady(cf,null):void 0;}}cd=cb.s;ce=cc.s;return cd!=null&&cd.$==0?ce!=null&&ce.$==0?X.New({$:0,$0:null}):cc:ce!=null&&ce.$==0?cb:(cf=X.New({$:3,$0:[],$1:[]}),(X.When(cb,cg,cf),X.When(cc,cg,cf),cf));};X.Copy=function(cb){var cc,cd,ce;cc=cb.s;return cc==null?cb:cc!=null&&cc.$==2?(cd=X.New({$:2,$0:cc.$0,$1:[]}),(X.WhenObsolete(cb,cd),cd)):cc!=null&&cc.$==3?(ce=X.New({$:3,$0:[],$1:[]}),(X.When(cb,function(cf){X.MarkDone(ce,cb,cf);},ce),ce)):cb;};X.WhenObsolete=function(cb,cc){var cd;cd=cb.s;if(cd==null)X.Obsolete(cc);else cd!=null&&cd.$==2?X.EnqueueSafe(cd.$1,cc):cd!=null&&cd.$==3?X.EnqueueSafe(cd.$1,cc):void 0;};X.Map3=function(cb,cc,cd,ce){var cf,cg,ch,ci;function cj(ck){var cl,cm,cn,co;if(!(cl=ci.s,cl!=null&&cl.$==0||cl!=null&&cl.$==2)){cm=X.ValueAndForever(cc);cn=X.ValueAndForever(cd);co=X.ValueAndForever(ce);if(cm!=null&&cm.$==1)cn!=null&&cn.$==1?co!=null&&co.$==1?cm.$0[1]&&cn.$0[1]&&co.$0[1]?X.MarkForever(ci,cb(cm.$0[0],cn.$0[0],co.$0[0])):X.MarkReady(ci,cb(cm.$0[0],cn.$0[0],co.$0[0])):void 0:void 0;}}cf=cc.s;cg=cd.s;ch=ce.s;return cf!=null&&cf.$==0?cg!=null&&cg.$==0?ch!=null&&ch.$==0?X.New({$:0,$0:cb(cf.$0,cg.$0,ch.$0)}):X.Map3Opt1(cb,cf.$0,cg.$0,ce):ch!=null&&ch.$==0?X.Map3Opt2(cb,cf.$0,ch.$0,cd):X.Map3Opt3(cb,cf.$0,cd,ce):cg!=null&&cg.$==0?ch!=null&&ch.$==0?X.Map3Opt4(cb,cg.$0,ch.$0,cc):X.Map3Opt5(cb,cg.$0,cc,ce):ch!=null&&ch.$==0?X.Map3Opt6(cb,ch.$0,cc,cd):(ci=X.New({$:3,$0:[],$1:[]}),(X.When(cc,cj,ci),X.When(cd,cj,ci),X.When(ce,cj,ci),ci));};X.Sequence=function(cb){var cc,cd,ce;function cf(cg){var ch;if(ce[0]===0){ch=J.map(function(ci){var cj;cj=ci.s;return cj!=null&&cj.$==0?cj.$0:cj!=null&&cj.$==2?cj.$0:m.FailWith("value not found by View.Sequence");},cc);if(J.forall(function(ci){var cj;cj=ci.s;return cj!=null&&cj.$==0;},cc))X.MarkForever(cd,ch);else X.MarkReady(cd,ch);}else ce[0]--;}cc=J.ofSeq(cb);return cc.length==0?X.New({$:0,$0:[]}):(cd=X.New({$:3,$0:[],$1:[]}),(ce=[J.length(cc)-1],(J.iter(function(cg){X.When(cg,cf,cd);},cc),cd)));};X.Map3Opt1=function(cb,cc,cd,ce){return X.Map(function(cf){return cb(cc,cd,cf);},ce);};X.Map3Opt2=function(cb,cc,cd,ce){return X.Map(function(cf){return cb(cc,cf,cd);},ce);};X.Map3Opt3=function(cb,cc,cd,ce){return X.Map2(function(cf,cg){return cb(cc,cf,cg);},cd,ce);};X.Map3Opt4=function(cb,cc,cd,ce){return X.Map(function(cf){return cb(cf,cc,cd);},ce);};X.Map3Opt5=function(cb,cc,cd,ce){return X.Map2(function(cf,cg){return cb(cf,cc,cg);},cd,ce);};X.Map3Opt6=function(cb,cc,cd,ce){return X.Map2(function(cf,cg){return cb(cf,cg,cc);},cd,ce);};Y.Dynamic=function(cb,cc){return new _3({$:1,$0:new bl.New(cb,cc)});};Y.Static=function(cb){return new _3({$:3,$0:cb});};Y.AppendTree=function(cb,cc){var cd;return cb===null?cc:cc===null?cb:(cd=new _3({$:2,$0:cb,$1:cc}),(Y.SetFlags(cd,Y.Flags(cb)|Y.Flags(cc)),cd));};Y.Insert=function(cb,cc){var cd,ce,cf;function cg(ch){var ci,cj;while(true)if(!(ch===null)){if(ch!=null&&ch.$==1)return cd.push(ch.$0);else if(ch!=null&&ch.$==2){ci=ch.$1;cj=ch.$0;cg(cj);ch=ci;}else return ch!=null&&ch.$==3?ch.$0(cb):ch!=null&&ch.$==4?ce.push(ch.$0):null;}else return null;}cd=[];ce=[];cg(cc);cf=cd.slice(0);return br.New(cb,Y.Flags(cc),cf,ce.length===0?null:{$:1,$0:function(ch){P.iter(function(ci){ci(ch);},ce);}});};Y.EmptyAttr=function(){bP.$cctor();return bP.EmptyAttr;};Y.HasExitAnim=function(cb){var cc;cc=2;return(cb.DynFlags&cc)===cc;};Y.GetExitAnim=function(cb){return Y.GetAnim(cb,function(cc,cd){return cc.NGetExitAnim(cd);});};Y.HasEnterAnim=function(cb){var cc;cc=1;return(cb.DynFlags&cc)===cc;};Y.GetEnterAnim=function(cb){return Y.GetAnim(cb,function(cc,cd){return cc.NGetEnterAnim(cd);});};Y.HasChangeAnim=function(cb){var cc;cc=4;return(cb.DynFlags&cc)===cc;};Y.GetChangeAnim=function(cb){return Y.GetAnim(cb,function(cc,cd){return cc.NGetChangeAnim(cd);});};Y.Updates=function(cb){return bo.MapTreeReduce(function(cc){return cc.NChanged();},D.Const(),D.Map2Unit,cb.DynNodes);};Y.SetFlags=function(cb,cc){cb.flags=cc;};Y.Flags=function(cb){return cb!==null&&cb.hasOwnProperty("flags")?cb.flags:0;};Y.GetAnim=function(cb,cc){return be.Concat(J.map(function(cd){return cc(cd,cb.DynElem);},cb.DynNodes));};Y.Sync=function(cb,cc){J.iter(function(cd){cd.NSync(cb);},cc.DynNodes);};Y.Empty=function(cb){return br.New(cb,0,[],null);};Z.AddClass=function(cb,cc){var cd;cd=Z.getClass(cb);if(cd==="")Z.setClass(cb,cc);else!Z.clsRE(cc).test(cd)?Z.setClass(cb,cd+" "+cc):void 0;};Z.RemoveClass=function(cb,cc){var cd;Z.setClass(cb,(cd=Z.clsRE(cc),Z.getClass(cb).replace(cd,function(ce,cf,cg){return cf===""||cg===""?"":" ";})));};Z.ParseHTMLIntoFakeRoot=function(cb){var cc,cd,ce,cf,cg;function ch(ci,cj){var ck;while(true)if(cj===0)return ci;else{ck=cj;ci=ci.lastChild;cj=ck-1;}}cc=self.document.createElement("div");return!Z.rhtml().test(cb)?(cc.appendChild(self.document.createTextNode(cb)),cc):(cd=(ce=Z.rtagName().exec(cb),s.Equals(ce,null)?"":J.get(ce,1).toLowerCase()),(cf=(cg=(Z.wrapMap())[cd],cg?cg:Z.defaultWrap()),(cc.innerHTML=cf[1]+cb.replace(Z.rxhtmlTag(),"<$1></$2>")+cf[2],ch(cc,cf[0]))));};Z.getClass=function(cb){return cb instanceof a.SVGElement?cb.getAttribute("class"):cb.className;};Z.setClass=function(cb,cc){if(cb instanceof a.SVGElement)cb.setAttribute("class",cc);else cb.className=cc;};Z.clsRE=function(cb){return new a.RegExp("(\\s+|^)"+cb+"(?:\\s+"+cb+")*(\\s+|$)","g");};Z.rhtml=function(){bI.$cctor();return bI.rhtml;};Z.wrapMap=function(){bI.$cctor();return bI.wrapMap;};Z.defaultWrap=function(){bI.$cctor();return bI.defaultWrap;};Z.rxhtmlTag=function(){bI.$cctor();return bI.rxhtmlTag;};Z.rtagName=function(){bI.$cctor();return bI.rtagName;};Z.IterSelector=function(cb,cc,cd){var ce,cf,cg;ce=cb.querySelectorAll(cc);for(cf=0,cg=ce.length-1;cf<=cg;cf++)cd(ce[cf]);};Z.InsertAt=function(cb,cc,cd){var ce;if(!(cd.parentNode===cb&&cc===(ce=cd.nextSibling,s.Equals(ce,null)?null:ce)))cb.insertBefore(cd,cc);};Z.RemoveNode=function(cb,cc){if(cc.parentNode===cb)cb.removeChild(cc);};Z.ChildrenArray=function(cb){var cc,cd,ce;cc=[];for(cd=0,ce=cb.childNodes.length-1;cd<=ce;cd++)cc.push(cb.childNodes[cd]);return cc;};_1.NewGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(new a.RegExp("[xy]","g"),function(cb){var cc,cd;cc=b$.random()*16|0;cd=cb=="x"?cc:cc&3|8;return cd.toString(16);});};_2=q.List=b9.Class({GetEnumerator:function(){return ba.Get(this);},GetEnumerator0:function(){return ba.Get0(this);}},null,_2);_3=e.AttrProxy=b9.Class({},null,_3);_3.Create=function(cb,cc){return Y.Static(function(cd){cd.setAttribute(cb,cc);});};_3.Concat=function(cb){var cc;cc=bo.ofSeqNonCopying(cb);return bo.TreeReduce(Y.EmptyAttr(),_3.Append,cc);};_3.Append=function(cb,cc){return Y.AppendTree(cb,cc);};_3.Handler=function(cb,cc){return _3.HandlerImpl(cb,cc);};_3.HandlerImpl=function(cb,cc){return Y.Static(function(cd){cd.addEventListener(cb,function(ce){return(cc(cd))(ce);},false);});};_4.ofObj=function(cb){return cb==null?null:{$:1,$0:cb};};_7.Trim=function(cb){return cb.replace(new a.RegExp("^\\s+"),"").replace(new a.RegExp("\\s+$"),"");};_7.concat=function(cb,cc){return J.ofSeq(cc).join(cb);};_7.SplitChars=function(cb,cc,cd){return _7.Split(cb,new a.RegExp("["+_7.RegexEscape(cc.join(""))+"]"),cd);};_7.StartsWith=function(cb,cc){return cb.substring(0,cc.length)==cc;};_7.Split=function(cb,cc,cd){return cd===1?J.filter(function(ce){return ce!=="";},_7.SplitWith(cb,cc)):_7.SplitWith(cb,cc);};_7.RegexEscape=function(cb){return cb.replace(new a.RegExp("[-\\/\\\\^$*+?.()|[\\]{}]","g"),"\\$&");};_7.Substring=function(cb,cc,cd){return cb.substr(cc,cd);};_7.SplitWith=function(cb,cc){return cb.split(cc);};_7.forall=function(cb,cc){return P.forall(cb,_7.protect(cc));};_7.IsNullOrEmpty=function(cb){return cb==null||cb=="";};_7.Join=function(cb,cc){return cc.join(cb);};_7.protect=function(cb){return cb===null?"":cb;};_8.notPresent=function(){return m.FailWith("The given key was not present in the dictionary.");};J.exists=function(cb,cc){var cd,ce,cf,cg;cd=false;ce=0;cg=J.length(cc);while(!cd&&ce<cg)if(cb(cc[ce]))cd=true;else ce=ce+1;return cd;};J.tryPick=function(cb,cc){var cd,ce,cf;cd=null;ce=0;while(ce<cc.length&&cd==null){cf=cb(cc[ce]);if(cf!=null&&cf.$==1)cd=cf;ce=ce+1;}return cd;};J.tryFindIndex=function(cb,cc){var cd,ce;cd=null;ce=0;while(ce<cc.length&&cd==null){cb(cc[ce])?cd={$:1,$0:ce}:void 0;ce=ce+1;}return cd;};J.ofSeq=function(cb){var cc,cd;if(cb instanceof a.Array)return cb.slice();else if(cb instanceof w)return J.ofList(cb);else{cc=[];cd=ba.Get(cb);try{while(cd.MoveNext())cc.push(cd.Current());return cc;}finally{if(typeof cd=="object"&&"Dispose"in cd)cd.Dispose();}}};J.iteri=function(cb,cc){var cd,ce;for(cd=0,ce=cc.length-1;cd<=ce;cd++)cb(cd,cc[cd]);};J.tryFind=function(cb,cc){var cd,ce;cd=null;ce=0;while(ce<cc.length&&cd==null){cb(cc[ce])?cd={$:1,$0:cc[ce]}:void 0;ce=ce+1;}return cd;};J.choose=function(cb,cc){var cd,ce,cf,cg;cd=[];for(ce=0,cf=cc.length-1;ce<=cf;ce++){cg=cb(cc[ce]);if(cg==null);else cd.push(cg.$0);}return cd;};J.filter=function(cb,cc){var cd,ce,cf;cd=[];for(ce=0,cf=cc.length-1;ce<=cf;ce++)if(cb(cc[ce]))cd.push(cc[ce]);return cd;};J.map=function(cb,cc){var cd,ce,cf;cd=new a.Array(cc.length);for(ce=0,cf=cc.length-1;ce<=cf;ce++)cd[ce]=cb(cc[ce]);return cd;};J.iter=function(cb,cc){var cd,ce;for(cd=0,ce=cc.length-1;cd<=ce;cd++)cb(cc[cd]);};J.foldBack=function(cb,cc,cd){var ce,cf,cg,ch,ci;ce=cd;cg=cc.length;for(ch=1,ci=cg;ch<=ci;ch++)ce=cb(cc[cg-ch],ce);return ce;};J.ofList=function(cb){var cc,cd;cd=[];cc=cb;while(!(cc.$==0)){cd.push(v.head(cc));cc=v.tail(cc);}return cd;};J.pick=function(cb,cc){var cd;cd=J.tryPick(cb,cc);return cd==null?m.FailWith("KeyNotFoundException"):cd.$0;};J.concat=function(cb){return a.Array.prototype.concat.apply([],J.ofSeq(cb));};J.create=function(cb,cc){var cd,ce,cf;cd=new a.Array(cb);for(ce=0,cf=cb-1;ce<=cf;ce++)cd[ce]=cc;return cd;};J.sortInPlace=function(cb){J.mapInPlace(function(cc){return cc[0];},J.mapiInPlace(function(cc,cd){return[cd,cc];},cb).sort(s.Compare));};J.find=function(cb,cc){var cd;cd=J.tryFind(cb,cc);return cd==null?m.FailWith("KeyNotFoundException"):cd.$0;};J.init=function(cb,cc){var cd,ce,cf;if(cb<0)m.FailWith("Negative size given.");else null;cd=new a.Array(cb);for(ce=0,cf=cb-1;ce<=cf;ce++)cd[ce]=cc(ce);return cd;};J.forall=function(cb,cc){var cd,ce,cf,cg;cd=true;ce=0;cg=J.length(cc);while(cd&&ce<cg)if(cb(cc[ce]))ce=ce+1;else cd=false;return cd;};_.convertTextNode=function(cb){var cc,cd,ce,cf,cg,ch;cc=null;cd=0;cf=cb.textContent;cg=new a.RegExp(g.TextHoleRE(),"g");while(cc=cg.exec(cf),cc!==null){cb.parentNode.insertBefore(self.document.createTextNode($.string(cf,{$:1,$0:cd},{$:1,$0:cg.lastIndex-J.get(cc,0).length-1})),cb);cd=cg.lastIndex;ch=self.document.createElement("span");ch.setAttribute("ws-replace",J.get(cc,1).toLowerCase());cb.parentNode.insertBefore(ch,cb);}cg.lastIndex=0;cb.textContent=$.string(cf,{$:1,$0:cd},null);};_.failNotLoaded=function(cb){b_.warn("Instantiating non-loaded template",cb);};_.fillTextHole=function(cb,cc,cd){var ce;ce=cb.querySelector("[ws-replace]");return s.Equals(ce,null)?(b_.warn("Filling non-existent text hole",cd),null):(ce.parentNode.replaceChild(self.document.createTextNode(cc),ce),{$:1,$0:ce.getAttribute("ws-replace")});};_.removeHolesExcept=function(cb,cc){function cd(ce){g.foreachNotPreserved(cb,"["+ce+"]",function(cf){if(!cc.Contains(cf.getAttribute(ce)))cf.removeAttribute(ce);});}cd("ws-attr");cd("ws-onafterrender");cd("ws-var");g.foreachNotPreserved(cb,"[ws-hole]",function(ce){if(!cc.Contains(ce.getAttribute("ws-hole"))){ce.removeAttribute("ws-hole");while(ce.hasChildNodes())ce.removeChild(ce.lastChild);}});g.foreachNotPreserved(cb,"[ws-replace]",function(ce){if(!cc.Contains(ce.getAttribute("ws-replace")))ce.parentNode.removeChild(ce);});g.foreachNotPreserved(cb,"[ws-on]",function(ce){ce.setAttribute("ws-on",_7.concat(" ",J.filter(function(cf){return cc.Contains(J.get(_7.SplitChars(cf,[":"],1),1));},_7.SplitChars(ce.getAttribute("ws-on"),[" "],1))));});g.foreachNotPreserved(cb,"[ws-attr-holes]",function(ce){var cf,cg,ch,ci,cj;cf=_7.SplitChars(ce.getAttribute("ws-attr-holes"),[" "],1);for(cg=0,ch=cf.length-1;cg<=ch;cg++){ci=J.get(cf,cg);ce.setAttribute(ci,(cj=new a.RegExp(g.TextHoleRE(),"g"),ce.getAttribute(ci).replace(cj,function(ck,cl){return cc.Contains(cl)?ck:"";})));}});};_.fillInstanceAttrs=function(cb,cc){var cd,ce,cf,cg,ch;_.convertAttrs(cc);cd=cc.nodeName.toLowerCase();ce=cb.querySelector("[ws-attr="+cd+"]");if(s.Equals(ce,null))b_.warn("Filling non-existent attr hole",cd);else{ce.removeAttribute("ws-attr");for(cf=0,cg=cc.attributes.length-1;cf<=cg;cf++){ch=cc.attributes.item(cf);if(ch.name==="class"&&ce.hasAttribute("class"))ce.setAttribute("class",ce.getAttribute("class")+" "+ch.nodeValue);else ce.setAttribute(ch.name,ch.nodeValue);}}};_.mapHoles=function(cb,cc){function cd(ce){g.foreachNotPreserved(cb,"["+ce+"]",function(cf){var cg,ch;cg=(ch=null,[cc.TryGetValue(cf.getAttribute(ce).toLowerCase(),{get:function(){return ch;},set:function(ci){ch=ci;}}),ch]);if(cg[0])cf.setAttribute(ce,cg[1]);});}cd("ws-hole");cd("ws-replace");cd("ws-attr");cd("ws-onafterrender");cd("ws-var");g.foreachNotPreserved(cb,"[ws-on]",function(ce){ce.setAttribute("ws-on",_7.concat(" ",J.map(function(cf){var cg,ch,ci;cg=_7.SplitChars(cf,[":"],1);ch=(ci=null,[cc.TryGetValue(J.get(cg,1),{get:function(){return ci;},set:function(cj){ci=cj;}}),ci]);return ch[0]?J.get(cg,0)+":"+ch[1]:cf;},_7.SplitChars(ce.getAttribute("ws-on"),[" "],1))));});g.foreachNotPreserved(cb,"[ws-attr-holes]",function(ce){var cf,cg,ch;cf=_7.SplitChars(ce.getAttribute("ws-attr-holes"),[" "],1);for(cg=0,ch=cf.length-1;cg<=ch;cg++)(function(){var ci;function cj(ck,cl){var cm;cm=m.KeyValue(cl);return ck.replace(new a.RegExp("\\${"+cm[0]+"}","ig"),"${"+cm[1]+"}");}ci=J.get(cf,cg);return ce.setAttribute(ci,(((b9.Curried3(P.fold))(cj))(ce.getAttribute(ci)))(cc));}());});};_.fill=function(cb,cc,cd){while(true)if(cb.hasChildNodes())cd=cc.insertBefore(cb.lastChild,cd);else return null;};_.convertAttrs=function(cb){var cd,ce,cf,cg,ch,ci,cj,ck;function cc(cl){var cm;cm=cb.getAttribute(cl);if(cm===null);else cb.setAttribute(cl,cm.toLowerCase());}cd=cb.attributes;ce=[];cf=[];cg=[];for(ch=0,ci=cd.length-1;ch<=ci;ch++){cj=cd.item(ch);if(_7.StartsWith(cj.nodeName,"ws-on")&&cj.nodeName!=="ws-onafterrender"&&cj.nodeName!=="ws-on"){ce.push(cj.nodeName);cf.push($.string(cj.nodeName,{$:1,$0:"ws-on".length},null)+":"+cj.nodeValue.toLowerCase());}else!_7.StartsWith(cj.nodeName,"ws-")&&(new a.RegExp(g.TextHoleRE())).test(cj.nodeValue)?(cj.nodeValue=(ck=new a.RegExp(g.TextHoleRE(),"g"),cj.nodeValue.replace(ck,function(cl,cm){return"${"+cm.toLowerCase()+"}";})),cg.push(cj.nodeName)):void 0;}if(!(cf.length==0))cb.setAttribute("ws-on",_7.concat(" ",cf));if(!(cg.length==0))cb.setAttribute("ws-attr-holes",_7.concat(" ",cg));cc("ws-hole");cc("ws-replace");cc("ws-attr");cc("ws-onafterrender");cc("ws-var");J.iter(function(cl){cb.removeAttribute(cl);},ce);};$.string=function(cb,cc,cd){var ce,cf;return cc==null?cd!=null&&cd.$==1?(ce=cd.$0,ce<0?"":cb.slice(0,ce+1)):"":cd==null?cb.slice(cc.$0):(cf=cd.$0,cf<0?"":cb.slice(cc.$0,cf+1));};ba.Get=function(cb){return cb instanceof a.Array?ba.ArrayEnumerator(cb):s.Equals(typeof cb,"string")?ba.StringEnumerator(cb):cb.GetEnumerator();};ba.ArrayEnumerator=function(cb){return new bF.New(0,null,function(cc){var cd;cd=cc.s;return cd<J.length(cb)&&(cc.c=J.get(cb,cd),cc.s=cd+1,true);},void 0);};ba.StringEnumerator=function(cb){return new bF.New(0,null,function(cc){var cd;cd=cc.s;return cd<cb.length&&(cc.c=cb[cd],cc.s=cd+1,true);},void 0);};ba.Get0=function(cb){return cb instanceof a.Array?ba.ArrayEnumerator(cb):s.Equals(typeof cb,"string")?ba.StringEnumerator(cb):"GetEnumerator0"in cb?cb.GetEnumerator0():cb.GetEnumerator();};P.insufficient=function(){return m.FailWith("The input sequence has an insufficient number of elements.");};J.mapiInPlace=function(cb,cc){var cd,ce;for(cd=0,ce=cc.length-1;cd<=ce;cd++)cc[cd]=cb(cd,cc[cd]);return cc;};J.mapInPlace=function(cb,cc){var cd,ce;for(cd=0,ce=cc.length-1;cd<=ce;cd++)cc[cd]=cb(cc[cd]);};bb=q.KeyCollection=b9.Class({GetEnumerator$1:function(){return ba.Get(P.map(function(cb){return cb.K;},this.d));},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();}},h,bb);bb.New=b9.Ctor(function(cb){h.New.call(this);this.d=cb;},bb);bc=e.DocElemNode=b9.Class({Equals:function(cb){return this.ElKey===cb.ElKey;},GetHashCode:function(){return this.ElKey;}},null,bc);bc.New=function(cb,cc,cd,ce,cf,cg){var ch;return new bc((ch={Attr:cb,Children:cc,El:ce,ElKey:cf},(b9.SetOptional(ch,"Delimiters",cd),b9.SetOptional(ch,"Render",cg),ch)));};be.get_UseAnimations=function(){return bw.UseAnimations();};be.Play=function(cb){var cc;cc=null;return bv.Delay(function(){return bv.Bind(be.Run(a.ignore,bw.Actions(cb)),function(){bw.Finalize(cb);return bv.Return(null);});});};be.Append=function(cb,cc){return{$:0,$0:bK.Append(cb.$0,cc.$0)};};be.Run=function(cb,cc){var cd;function ce(cf){function cg(ch){return function(ci){var cj;cj=ci-ch;cc.Compute(cj);cb();return cj<=cd?void a.requestAnimationFrame(function(ck){(cg(ch))(ck);}):cf();};}a.requestAnimationFrame(function(ch){(cg(ch))(ch);});}cd=cc.Duration;return cd===0?bv.Zero():bv.FromContinuations(function(cf,cg,ch){return ce.apply(null,[cf,cg,ch]);});};be.Concat=function(cb){return{$:0,$0:bK.Concat(P.map(bw.List,cb))};};be.get_Empty=function(){return{$:0,$0:bK.Empty()};};bf.BatchUpdatesEnabled=function(){bx.$cctor();return bx.BatchUpdatesEnabled;};bh.StartProcessor=function(cb){var cc;function cd(){var ce;ce=null;return bv.Delay(function(){return bv.Bind(cb,function(){var cf;cf=cc[0];return s.Equals(cf,1)?(cc[0]=0,bv.Zero()):s.Equals(cf,2)?(cc[0]=1,cd()):bv.Zero();});});}cc=[0];return function(){var ce;ce=cc[0];if(s.Equals(ce,0)){cc[0]=1;bv.Start(cd(),null);}else s.Equals(ce,1)?cc[0]=2:void 0;};};bi=q.FSharpMap=b9.Class({Equals:function(cb){return this.get_Count()===cb.get_Count()&&P.forall2(s.Equals,this,cb);},get_Count:function(){var cb;cb=this.tree;return cb==null?0:cb.Count;},GetEnumerator$1:function(){return ba.Get(P.map(function(cb){return{K:cb.Key,V:cb.Value};},by.Enumerate(false,this.tree)));},GetHashCode:function(){return s.Hash(J.ofSeq(this));},get_IsEmpty:function(){return this.tree==null;},Add:function(cb,cc){return new bi.New$1(by.Add(bA.New(cb,cc),this.tree));},get_Tree:function(){return this.tree;},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();},CompareTo0:function(cb){return P.compareWith(s.Compare,this,cb);}},h,bi);bi.New=b9.Ctor(function(cb){bi.New$1.call(this,bY.fromSeq(cb));},bi);bi.New$1=b9.Ctor(function(cb){h.New.call(this);this.tree=cb;},bi);bj=U.ArrayStorage=b9.Class({SSet:function(cb){return J.ofSeq(cb);},SRemoveIf:function(cb,cc){return J.filter(function(cd){return!cb(cd);},cc);},SSetAt:function(cb,cc,cd){J.set(cd,cb,cc);return cd;},SAppend:function(cb,cc){cc.push(cb);return cc;},SInit:function(){return this.init;}},h,bj);bj.New=b9.Ctor(function(cb){h.New.call(this);this.init=cb;},bj);bk.Int=function(){bk.set_counter(bk.counter()+1);return bk.counter();};bk.set_counter=function(cb){bO.$cctor();bO.counter=cb;};bk.counter=function(){bO.$cctor();return bO.counter;};bk.Id=function(){bk.set_counter(bk.counter()+1);return"uid"+a.String(bk.counter());};bl=e.DynamicAttrNode=b9.Class({NGetExitAnim:function(cb){return be.get_Empty();},NGetEnterAnim:function(cb){return be.get_Empty();},NGetChangeAnim:function(cb){return be.get_Empty();},NChanged:function(){return this.updates;},NSync:function(cb){if(this.dirty){(this.push(cb))(this.value);this.dirty=false;}}},h,bl);bl.New=b9.Ctor(function(cb,cc){var cd;cd=this;h.New.call(this);this.push=cc;this.value=void 0;this.dirty=false;this.updates=D.Map(function(ce){cd.value=ce;cd.dirty=true;},cb);},bl);bn=bm.attr=b9.Class({},h,bn);X.Obsolete=function(cb){var cc,cd,ce,cf,cg;cd=cb.s;if(cd==null||(cd!=null&&cd.$==2?(cc=cd.$1,false):cd!=null&&cd.$==3?(cc=cd.$1,false):true))void 0;else{cb.s=null;for(ce=0,cf=J.length(cc)-1;ce<=cf;ce++){cg=J.get(cc,ce);if(typeof cg=="object")(function(ch){X.Obsolete(ch);}(cg));else cg();}}};X.New=function(cb){return{s:cb};};bo.ofSeqNonCopying=function(cb){var cc,cd;if(cb instanceof a.Array)return cb;else if(cb instanceof w)return J.ofList(cb);else if(cb===null)return[];else{cc=[];cd=ba.Get(cb);try{while(cd.MoveNext())cc.push(cd.Current());return cc;}finally{if(typeof cd=="object"&&"Dispose"in cd)cd.Dispose();}}};bo.TreeReduce=function(cb,cc,cd){var ce;function cf(cg){return function(ch){var ci,cj;return ch<=0?cb:ch===1&&(cg>=0&&cg<ce)?J.get(cd,cg):(cj=ch/2>>0,cc((cf(cg))(cj),(cf(cg+cj))(ch-cj)));};}ce=J.length(cd);return(cf(0))(ce);};bo.mapInPlace=function(cb,cc){var cd,ce;for(cd=0,ce=cc.length-1;cd<=ce;cd++)cc[cd]=cb(cc[cd]);return cc;};bo.MapTreeReduce=function(cb,cc,cd,ce){var cf;function cg(ch){return function(ci){var cj,ck;return ci<=0?cc:ci===1&&(ch>=0&&ch<cf)?cb(J.get(ce,ch)):(ck=ci/2>>0,cd((cg(ch))(ck),(cg(ch+ck))(ci-ck)));};}cf=J.length(ce);return(cg(0))(cf);};bp.$cctor=function(){bp.$cctor=a.ignore;bp.initialized=new r.New$5();};bp=H.TemplateInitializer=b9.Class({},h,bp);bp.GetOrAddHoleFor=function(cb,cc,cd){var ce,cf,cg,ch;bp.$cctor();ce=bp.GetHolesFor(cb);cf=(cg=null,[ce.TryGetValue(cc,{get:function(){return cg;},set:function(ci){cg=ci;}}),cg]);return cf[0]?cf[1]:(ch=cd(),(ce.set_Item(cc,ch),ch));};bp.GetHolesFor=function(cb){var cc,cd,ce;bp.$cctor();cc=(cd=null,[bp.initialized.TryGetValue(cb,{get:function(){return cd;},set:function(cf){cd=cf;}}),cd]);return cc[0]?cc[1]:(ce=new r.New$5(),(bp.initialized.set_Item(cb,ce),ce));};br.New=function(cb,cc,cd,ce){var cf;cf={DynElem:cb,DynFlags:cc,DynNodes:cd};b9.SetOptional(cf,"OnAfterRender",ce);return cf;};bt.New=function(cb,cc){return{PreviousNodes:cb,Top:cc};};bu.get_Empty=function(){return{$:0,$0:new O.New$3()};};bu.FindAll=function(cb){var cc;function cd(cg,ch){var ci,cj,ck,cl,cm;while(true)switch(cg){case 0:if(ch!=null&&ch.$==0){cj=ch.$1;ck=ch.$0;cd(0,ck);ch=cj;}else if(ch!=null&&ch.$==1){cl=ch.$0;ch=cl;cg=1;}else if(ch!=null&&ch.$==2){cm=ch.$0;ch=cm.Current;}else return ch!=null&&ch.$==6?(ci=ch.$0.Holes,(function(cn){return function(co){J.iter(cn,co);};}(cf))(ci)):null;break;case 1:cc.push(ch);ch=ch.Children;cg=0;break;}}function ce(cg){return cd(0,cg);}function cf(cg){return cd(1,cg);}cc=[];ce(cb);return{$:0,$0:new O.New$2(cc)};};bu.Filter=function(cb,cc){return{$:0,$0:bX.Filter(cb,cc.$0)};};bu.Except=function(cb,cc){return{$:0,$0:bX.Except(cb.$0,cc.$0)};};bu.ToArray=function(cb){return bX.ToArray(cb.$0);};bu.Intersect=function(cb,cc){return{$:0,$0:bX.Intersect(cb.$0,cc.$0)};};bv.Delay=function(cb){return function(cc){try{(cb(null))(cc);}catch(cd){cc.k({$:1,$0:cd});}};};bv.Bind=function(cb,cc){return bv.checkCancel(function(cd){cb(bU.New(function(ce){var cf;if(ce.$==0){cf=ce.$0;bv.scheduler().Fork(function(){try{(cc(cf))(cd);}catch(cg){cd.k({$:1,$0:cg});}});}else bv.scheduler().Fork(function(){cd.k(ce);});},cd.ct));});};bv.Zero=function(){bV.$cctor();return bV.Zero;};bv.Start=function(cb,cc){var cd,ce;cd=(ce=(bv.defCTS())[0],cc==null?ce:cc.$0);bv.scheduler().Fork(function(){if(!cd.c)cb(bU.New(function(cf){if(cf.$==1)bv.UncaughtAsyncError(cf.$0);},cd));});};bv.Return=function(cb){return function(cc){cc.k({$:0,$0:cb});};};bv.scheduler=function(){bV.$cctor();return bV.scheduler;};bv.checkCancel=function(cb){return function(cc){if(cc.ct.c)bv.cancel(cc);else cb(cc);};};bv.defCTS=function(){bV.$cctor();return bV.defCTS;};bv.UncaughtAsyncError=function(cb){b_.log("WebSharper: Uncaught asynchronous exception",cb);};bv.FromContinuations=function(cb){return function(cc){var cd;function ce(cf){if(cd[0])m.FailWith("A continuation provided by Async.FromContinuations was invoked multiple times");else{cd[0]=true;bv.scheduler().Fork(cf);}}cd=[false];cb(function(cf){ce(function(){cc.k({$:0,$0:cf});});},function(cf){ce(function(){cc.k({$:1,$0:cf});});},function(cf){ce(function(){cc.k({$:2,$0:cf});});});};};bv.cancel=function(cb){cb.k({$:2,$0:new b6.New(cb.ct)});};bw.UseAnimations=function(){bJ.$cctor();return bJ.UseAnimations;};bw.Actions=function(cb){return bw.ConcatActions(J.choose(function(cc){return cc.$==1?{$:1,$0:cc.$0}:null;},bK.ToArray(cb.$0)));};bw.Finalize=function(cb){J.iter(function(cc){if(cc.$==0)cc.$0();},bK.ToArray(cb.$0));};bw.ConcatActions=function(cb){var cc,cd,ce,cf;cc=bo.ofSeqNonCopying(cb);cd=J.length(cc);return cd===0?bw.Const():cd===1?J.get(cc,0):(ce=P.max(P.map(function(cg){return cg.Duration;},cc)),(cf=J.map(function(cg){return bw.Prolong(ce,cg);},cc),bw.Def(ce,function(cg){J.iter(function(ch){ch.Compute(cg);},cf);})));};bw.List=function(cb){return cb.$0;};bw.Const=function(cb){return bw.Def(0,function(){return cb;});};bw.Def=function(cb,cc){return{Compute:cc,Duration:cb};};bw.Prolong=function(cb,cc){var cd,ce,cf;cd=cc.Compute;ce=cc.Duration;cf=bC.Create(function(){return cc.Compute(cc.Duration);});return{Compute:function(cg){return cg>=ce?cf.f():cd(cg);},Duration:cb};};bx.$cctor=function(){bx.$cctor=a.ignore;bx.BatchUpdatesEnabled=true;};bz.New=function(cb,cc,cd,ce,cf){return{Node:cb,Left:cc,Right:cd,Height:ce,Count:cf};};bA=q.Pair=b9.Class({Equals:function(cb){return s.Equals(this.Key,cb.Key);},GetHashCode:function(){return s.Hash(this.Key);},CompareTo0:function(cb){return s.Compare(this.Key,cb.Key);}},null,bA);bA.New=function(cb,cc){return new bA({Key:cb,Value:cc});};bB.OfArray=function(cb){return new bi.New$1(by.OfSeq(P.map(function(cc){return bA.New(cc[0],cc[1]);},cb)));};bB.FoldBack=function(cb,cc,cd){return P.fold(function(ce,cf){return cb(cf.Key,cf.Value,ce);},cd,by.Enumerate(true,cc.get_Tree()));};bB.ToSeq=function(cb){return P.map(function(cc){return[cc.Key,cc.Value];},by.Enumerate(false,cb.get_Tree()));};bC.CreateFromValue=function(cb){return bM.New(true,cb,bC.cachedLazy);};bC.cachedLazy=function(){return this.v;};bC.Create=function(cb){return bM.New(false,cb,bC.forceLazy);};bC.forceLazy=function(){var cb;cb=this.v();this.c=true;this.v=cb;this.f=bC.cachedLazy;return cb;};bD.toSafe=function(cb){return cb==null?"":cb;};bE=e.CheckedInput=b9.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,bE);bF=ba.T=b9.Class({MoveNext:function(){return this.n(this);},Current:function(){return this.c;},Dispose:function(){if(this.d)this.d(this);}},h,bF);bF.New=b9.Ctor(function(cb,cc,cd,ce){h.New.call(this);this.s=cb;this.c=cc;this.n=cd;this.d=ce;},bF);bG.BoolCheckedApply=function(){bP.$cctor();return bP.BoolCheckedApply;};bG.StringApply=function(){bP.$cctor();return bP.StringApply;};bG.ApplyValue=function(cb,cc,cd,ce,cf){return[ce(function(cg){function ch(){cd.UpdateMaybe(function(ci){var cj,ck;cj=cb(cg);return cj!=null&&cj.$==1&&(!s.Equals(cj.$0,ci)&&(ck=[cj,cj.$0],true))?ck[0]:null;});}cg.addEventListener("change",ch);cg.addEventListener("input",ch);cg.addEventListener("keypress",ch);}),cf(function(cg){return function(ch){var ci,cj;ci=cb(cg);return ci!=null&&ci.$==1&&(s.Equals(ci.$0,ch)&&(cj=ci.$0,true))?null:cc(cg,ch);};})];};bG.StringSet=function(){bP.$cctor();return bP.StringSet;};bG.StringGet=function(){bP.$cctor();return bP.StringGet;};bG.IntSetUnchecked=function(){bP.$cctor();return bP.IntSetUnchecked;};bG.IntGetUnchecked=function(){bP.$cctor();return bP.IntGetUnchecked;};bG.IntSetChecked=function(){bP.$cctor();return bP.IntSetChecked;};bG.IntGetChecked=function(){bP.$cctor();return bP.IntGetChecked;};bG.FloatSetUnchecked=function(){bP.$cctor();return bP.FloatSetUnchecked;};bG.FloatGetUnchecked=function(){bP.$cctor();return bP.FloatGetUnchecked;};bG.FloatSetChecked=function(){bP.$cctor();return bP.FloatSetChecked;};bG.FloatGetChecked=function(){bP.$cctor();return bP.FloatGetChecked;};bG.IntApplyChecked=function(){bP.$cctor();return bP.IntApplyChecked;};bG.IntApplyUnchecked=function(){bP.$cctor();return bP.IntApplyUnchecked;};bG.FloatApplyChecked=function(){bP.$cctor();return bP.FloatApplyChecked;};bG.FloatApplyUnchecked=function(){bP.$cctor();return bP.FloatApplyUnchecked;};bH=e.Elt=b9.Class({},i,bH);bH.New=function(cb,cc,cd){var ce,cf;ce=R.CreateElemNode(cb,cc,cd.docNode);cf=bQ.Create(cd.updates);return new bH.New$1({$:1,$0:ce},D.Map2Unit(Y.Updates(ce.Attr),cf.v),cb,cf);};bH.TreeNode=function(cb,cc){var cd,ce;function cf(cg){return cg[1];}cd=bQ.Create(cc);return new bH.New$1({$:6,$0:cb},D.Map2Unit((ce=J.map(function(cg){return Y.Updates(cf(cg));},cb.Attrs),bo.TreeReduce(D.Const(),D.Map2Unit,ce)),cd.v),J.get(cb.Els,0),cd);};bH.New$1=b9.Ctor(function(cb,cc,cd,ce){i.New.call(this,cb,cc);this.docNode$1=cb;this.updates$1=cc;this.elt=cd;this.rvUpdates=ce;},bH);bI.$cctor=function(){var cb;bI.$cctor=a.ignore;bI.rxhtmlTag=new a.RegExp("<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>","gi");bI.rtagName=new a.RegExp("<([\\w:]+)");bI.rhtml=new a.RegExp("<|&#?\\w+;");bI.wrapMap=(cb=[1,"<table>","</table>"],{option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:cb,tbody:cb,tfoot:cb,tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><colgroup>","</colgoup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"]});bI.defaultWrap=[0,"",""];};bJ.$cctor=function(){bJ.$cctor=a.ignore;bJ.CubicInOut=bT.Custom(function(cb){var cc;cc=cb*cb;return 3*cc-2*(cc*cb);});bJ.UseAnimations=true;};bK.Append=function(cb,cc){return cb.$==0?cc:cc.$==0?cb:{$:2,$0:cb,$1:cc};};bK.ToArray=function(cb){var cc;function cd(ce){var cf,cg;while(true)if(ce.$==1)return cc.push(ce.$0);else if(ce.$==2){cf=ce.$1;cg=ce.$0;cd(cg);ce=cf;}else return ce.$==3?J.iter(function(ch){cc.push(ch);},ce.$0):null;}cc=[];cd(cb);return cc.slice(0);};bK.Concat=function(cb){var cc;cc=bo.ofSeqNonCopying(cb);return bo.TreeReduce(bK.Empty(),bK.Append,cc);};bK.Empty=function(){b7.$cctor();return b7.Empty;};bM.New=function(cb,cc,cd){return{c:cb,v:cc,f:cd};};bN.WriteLink=function(cb,cc){var cd;cd=cc.get_IsEmpty()?"":"?"+bN.WriteQuery(cc);return"/"+bN.Concat(cb)+cd;};bN.Concat=function(cb){var cc,cd;cc=[];cd=true;v.iter(function(ce){if(!_7.IsNullOrEmpty(ce)){cd?cd=false:cc.push("/");cc.push(ce);}},cb);return _7.Join("",J.ofSeq(cc));};bN.WriteQuery=function(cb){function cc(cd,ce){return cd+"="+ce;}return _7.concat("&",P.map(function(cd){return cc(cd[0],cd[1]);},bB.ToSeq(cb)));};bO.$cctor=function(){bO.$cctor=a.ignore;bO.counter=0;};bP.$cctor=function(){var cb,cc,cd,ce,cf,cg,ch,ci,cj,ck;bP.$cctor=a.ignore;bP.EmptyAttr=null;bP.BoolCheckedApply=b9.Curried3(function(cl,cm,cn){return[cm(function(co){co.addEventListener("change",function(){return!s.Equals(cl.Get(),co.checked)?cl.Set(co.checked):null;});}),cn(function(co){return function(cp){co.checked=cp;};})];});bP.StringSet=function(cl){return function(cm){cl.value=cm;};};bP.StringGet=function(cl){return{$:1,$0:cl.value};};bP.StringApply=(cb=bG.StringGet(),(cc=bG.StringSet(),b9.Curried(bG.ApplyValue,3,[cb,function(cl,cm){return(cc(cl))(cm);}])));bP.IntSetUnchecked=function(cl){return function(cm){cl.value=a.String(cm);};};bP.IntGetUnchecked=function(cl){var cm,cn;cm=cl.value;return b0.isBlank(cm)?{$:1,$0:0}:(cn=+cm,cn!==cn>>0?null:{$:1,$0:cn});};bP.IntApplyUnchecked=(cd=bG.IntGetUnchecked(),(ce=bG.IntSetUnchecked(),b9.Curried(bG.ApplyValue,3,[cd,function(cl,cm){return(ce(cl))(cm);}])));bP.IntSetChecked=function(cl){return function(cm){var cn;cn=cm.get_Input();return cl.value!==cn?void(cl.value=cn):null;};};bP.IntGetChecked=function(cl){var cm,cn,co;cm=cl.value;return{$:1,$0:b0.isBlank(cm)?(cl.checkValidity?cl.checkValidity():true)?new bE({$:2,$0:cm}):new bE({$:1,$0:cm}):(cn=(co=0,[V.TryParseInt32(cm,{get:function(){return co;},set:function(cp){co=cp;}}),co]),cn[0]?new bE({$:0,$0:cn[1],$1:cm}):new bE({$:1,$0:cm}))};};bP.IntApplyChecked=(cf=bG.IntGetChecked(),(cg=bG.IntSetChecked(),b9.Curried(bG.ApplyValue,3,[cf,function(cl,cm){return(cg(cl))(cm);}])));bP.FloatSetUnchecked=function(cl){return function(cm){cl.value=a.String(cm);};};bP.FloatGetUnchecked=function(cl){var cm,cn;cm=cl.value;return b0.isBlank(cm)?{$:1,$0:0}:(cn=+cm,a.isNaN(cn)?null:{$:1,$0:cn});};bP.FloatApplyUnchecked=(ch=bG.FloatGetUnchecked(),(ci=bG.FloatSetUnchecked(),b9.Curried(bG.ApplyValue,3,[ch,function(cl,cm){return(ci(cl))(cm);}])));bP.FloatSetChecked=function(cl){return function(cm){var cn;cn=cm.get_Input();return cl.value!==cn?void(cl.value=cn):null;};};bP.FloatGetChecked=function(cl){var cm,cn;cm=cl.value;return{$:1,$0:b0.isBlank(cm)?(cl.checkValidity?cl.checkValidity():true)?new bE({$:2,$0:cm}):new bE({$:1,$0:cm}):(cn=+cm,a.isNaN(cn)?new bE({$:1,$0:cm}):new bE({$:0,$0:cn,$1:cm}))};};bP.FloatApplyChecked=(cj=bG.FloatGetChecked(),(ck=bG.FloatSetChecked(),b9.Curried(bG.ApplyValue,3,[cj,function(cl,cm){return(ck(cl))(cm);}])));};bQ=e.Updates=b9.Class({},null,bQ);bQ.Create=function(cb){var cc;cc=null;cc=bQ.New(cb,null,function(){var cd;cd=cc.s;return cd===null?(cd=X.Copy(cc.c()),cc.s=cd,X.WhenObsoleteRun(cd,function(){cc.s=null;}),cd):cd;});return cc;};bQ.New=function(cb,cc,cd){return new bQ({c:cb,s:cc,v:cd});};bR.concat=function(cb){var cc,cd;cc=[];for(var ce in cb)cc.push.apply(cc,cb[ce]);return cc;};by.Enumerate=function(cb,cc){function cd(ce,cf){var cg;while(true)if(ce==null)return cf.$==1?{$:1,$0:[cf.$0[0],[cf.$0[1],cf.$1]]}:null;else if(cb){cg=ce;ce=cg.Right;cf=new w({$:1,$0:[cg.Node,cg.Left],$1:cf});}else{cg=ce;ce=cg.Left;cf=new w({$:1,$0:[cg.Node,cg.Right],$1:cf});}}return P.unfold(function(ce){return cd(ce[0],ce[1]);},[cc,w.Empty]);};by.OfSeq=function(cb){var cc;cc=J.ofSeq(P.distinct(cb));J.sortInPlace(cc);return by.Build(cc,0,cc.length-1);};by.Build=function(cb,cc,cd){var ce,cf,cg;return cd-cc+1<=0?null:(ce=(cc+cd)/2>>0,(cf=by.Build(cb,cc,ce-1),(cg=by.Build(cb,ce+1,cd),by.Branch(J.get(cb,ce),cf,cg))));};by.Add=function(cb,cc){return by.Put(function(cd,ce){return ce;},cb,cc);};by.Branch=function(cb,cc,cd){var ce,cf;return bz.New(cb,cc,cd,1+(ce=cc==null?0:cc.Height,(cf=cd==null?0:cd.Height,s.Compare(ce,cf)===1?ce:cf)),1+(cc==null?0:cc.Count)+(cd==null?0:cd.Count));};by.Put=function(cb,cc,cd){var ce,cf;ce=by.Lookup(cc,cd);cf=ce[0];return cf==null?by.Rebuild(ce[1],by.Branch(cc,null,null)):by.Rebuild(ce[1],by.Branch(cb(cf.Node,cc),cf.Left,cf.Right));};by.Lookup=function(cb,cc){var cd,ce,cf,cg;cd=[];ce=cc;cf=true;while(cf)if(ce==null)cf=false;else{cg=s.Compare(cb,ce.Node);if(cg===0)cf=false;else cg===1?(cd.unshift([true,ce.Node,ce.Left]),ce=ce.Right):(cd.unshift([false,ce.Node,ce.Right]),ce=ce.Left);}return[ce,cd];};by.Rebuild=function(cb,cc){var cd,cf,cg,ch,ci,cj,ck,cl,cm,cn;function ce(co){return co==null?0:co.Height;}cd=cc;for(cf=0,cg=J.length(cb)-1;cf<=cg;cf++){cd=(ch=J.get(cb,cf),ch[0]?(ci=ch[1],(cj=ch[2],ce(cd)>ce(cj)+1?ce(cd.Left)===ce(cd.Right)+1?(ck=cd.Left,by.Branch(ck.Node,by.Branch(ci,cj,ck.Left),by.Branch(cd.Node,ck.Right,cd.Right))):by.Branch(cd.Node,by.Branch(ci,cj,cd.Left),cd.Right):by.Branch(ci,cj,cd))):(cl=ch[1],(cm=ch[2],ce(cd)>ce(cm)+1?ce(cd.Right)===ce(cd.Left)+1?(cn=cd.Right,by.Branch(cn.Node,by.Branch(cd.Node,cd.Left,cn.Left),by.Branch(cl,cn.Right,cm))):by.Branch(cd.Node,cd.Left,by.Branch(cl,cd.Right,cm)):by.Branch(cl,cd,cm))));}return cd;};bS=bv.Scheduler=b9.Class({Fork:function(cb){var cc;cc=this;this.robin.push(cb);if(this.idle){this.idle=false;a.setTimeout(function(){cc.tick();},0);}},tick:function(){var cb,cc,cd;cc=this;cd=ca.now();cb=true;while(cb)if(this.robin.length===0){this.idle=true;cb=false;}else{(this.robin.shift())();ca.now()-cd>40?(a.setTimeout(function(){cc.tick();},0),cb=false):void 0;}}},h,bS);bS.New=b9.Ctor(function(){h.New.call(this);this.idle=true;this.robin=[];},bS);bT=e.Easing=b9.Class({},h,bT);bT.Custom=function(cb){return new bT.New(cb);};bT.New=b9.Ctor(function(cb){h.New.call(this);this.transformTime=cb;},bT);bU.New=function(cb,cc){return{k:cb,ct:cc};};bV.$cctor=function(){bV.$cctor=a.ignore;bV.noneCT=bW.New(false,[]);bV.scheduler=new bS.New();bV.defCTS=[new b1.New()];bV.Zero=bv.Return();bV.GetCT=function(cb){cb.k({$:0,$0:cb.ct});};};bW.New=function(cb,cc){return{c:cb,r:cc};};bX.Filter=function(cb,cc){return new O.New$2(J.filter(cb,bX.ToArray(cc)));};bX.Except=function(cb,cc){var cd;cd=new O.New$2(bX.ToArray(cc));cd.ExceptWith(bX.ToArray(cb));return cd;};bX.ToArray=function(cb){var cc;cc=J.create(cb.get_Count(),void 0);cb.CopyTo(cc);return cc;};bX.Intersect=function(cb,cc){var cd;cd=new O.New$2(bX.ToArray(cb));cd.IntersectWith(bX.ToArray(cc));return cd;};bY.fromSeq=function(cb){var cc;cc=J.ofSeq(P.map(function(cd){return bA.New(cd[0],cd[1]);},P.distinctBy(function(cd){return cd[0];},P.rev(cb))));J.sortInPlace(cc);return by.Build(cc,0,cc.length-1);};bZ.Clear=function(cb){cb.splice(0,J.length(cb));};b0.isBlank=function(cb){return _7.forall(b3.IsWhiteSpace,cb);};b1=d.CancellationTokenSource=b9.Class({},h,b1);b1.New=b9.Ctor(function(){h.New.call(this);this.c=false;this.pending=null;this.r=[];this.init=1;},b1);b2.Children=function(cb,cc){var cd,ce,cf;if(cc!=null&&cc.$==1){cf=[];cd=cc.$0[0].nextSibling;while(cd!==cc.$0[1]){cf.push(cd);cd=cd.nextSibling;}return{$:0,$0:cf};}else return{$:0,$0:J.init(cb.childNodes.length,(ce=cb.childNodes,function(cg){return ce[cg];}))};};b2.Except=function(cb,cc){var cd;cd=cb.$0;return{$:0,$0:J.filter(function(ce){return J.forall(function(cf){return!(ce===cf);},cd);},cc.$0)};};b2.Iter=function(cb,cc){J.iter(cb,cc.$0);};b2.DocChildren=function(cb){var cc;function cd(ce){var cf,cg,ch,ci;while(true){if(ce!=null&&ce.$==2){cg=ce.$0;ce=cg.Current;}else if(ce!=null&&ce.$==1)return cc.push(ce.$0.El);else if(ce==null)return null;else if(ce!=null&&ce.$==5)return cc.push(ce.$0);else if(ce!=null&&ce.$==4)return cc.push(ce.$0.Text);else if(ce!=null&&ce.$==6){cf=ce.$0.Els;return(function(cj){return function(ck){J.iter(cj,ck);};}(function(cj){if(cj==null||cj.constructor===_9)cd(cj);else cc.push(cj);}))(cf);}else{ch=ce.$1;ci=ce.$0;cd(ci);ce=ch;}}}cc=[];cd(cb.Children);return{$:0,$0:bo.ofSeqNonCopying(cc)};};b3.IsWhiteSpace=function(cb){return cb.match(new a.RegExp("\\s"))!==null;};V.TryParse=function(cb,cc,cd,ce){var cf,cg;cf=+cb;cg=cf===cf-cf%1&&cf>=cc&&cf<=cd;if(cg)ce.set(cf);return cg;};b4=q.ValueCollection=b9.Class({GetEnumerator$1:function(){return ba.Get(P.map(function(cb){return cb.V;},this.d));},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();}},h,b4);b4.New=b9.Ctor(function(cb){h.New.call(this);this.d=cb;},b4);b6=d.OperationCanceledException=b9.Class({},b5,b6);b6.New=b9.Ctor(function(cb){b6.New$1.call(this,"The operation was canceled.",null,cb);},b6);b6.New$1=b9.Ctor(function(cb,cc,cd){this.message=cb;this.inner=cc;_9.setPrototypeOf(this,b6.prototype);this.ct=cd;},b6);b7.$cctor=function(){b7.$cctor=a.ignore;b7.Empty={$:0};};b9.OnLoad(function(){c.Main();});}(self));


if (typeof IntelliFactory !=='undefined') {
  IntelliFactory.Runtime.ScriptBasePath = '/Content/';
  IntelliFactory.Runtime.Start();
}
